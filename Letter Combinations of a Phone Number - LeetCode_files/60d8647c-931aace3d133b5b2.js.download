"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[853],{11315:(e,t,n)=>{let r;n.d(t,{Pk:()=>H});var i=n(6585),o=n(15874),a=n(1371),s=n(54528),l=n(45230);function c(e,t){var n=t.ch,r=t.line+1;r<1&&(r=1,n=0),r>e.lines&&(r=e.lines,n=Number.MAX_VALUE);var i=e.line(r);return Math.min(i.from+Math.max(0,n),i.to)}function u(e,t){let n=e.lineAt(t);return{line:n.number-1,ch:t-n.from}}class h{constructor(e,t){this.line=e,this.ch=t}}function d(e,t,n){if(e.addEventListener)e.addEventListener(t,n,!1);else{var r=e._handlers||(e._handlers={});r[t]=(r[t]||[]).concat(n)}}function m(e,t,n){if(e.removeEventListener)e.removeEventListener(t,n,!1);else{var r=e._handlers,i=r&&r[t];if(i){var o=i.indexOf(n);o>-1&&(r[t]=i.slice(0,o).concat(i.slice(o+1)))}}}function p(e,t,...n){var r,i=null===(r=e._handlers)||void 0===r?void 0:r[t];if(i)for(var o=0;o<i.length;++o)i[o](...n)}function f(e,...t){if(e)for(var n=0;n<e.length;++n)e[n](...t)}try{r=RegExp("[\\w\\p{Alphabetic}\\p{Number}_]","u")}catch(e){r=/[\w]/}function g(e,t){var n=e.cm6;if(!n.state.readOnly){var r="input.type.compose";if(e.curOp&&!e.curOp.lastChange&&(r="input.type.compose.start"),t.annotations)try{t.annotations.some(function(e){"input"==e.value&&(e.value=r)})}catch(e){console.error(e)}else t.userEvent=r;return n.dispatch(t)}}function v(e,t){var n;e.curOp&&(e.curOp.$changeStart=void 0),(t?l.tN:l.ZS)(e.cm6);let r=null===(n=e.curOp)||void 0===n?void 0:n.$changeStart;null!=r&&e.cm6.dispatch({selection:{anchor:r}})}class y{constructor(e){this.state={},this.marks=Object.create(null),this.$mid=0,this.options={},this._handlers={},this.$lastChangeEndOffset=0,this.virtualSelection=null,this.cm6=e,this.onChange=this.onChange.bind(this),this.onSelectionChange=this.onSelectionChange.bind(this)}openDialog(e,t,n){return function(e,t,n,r){r||(r={}),k(e,void 0);var i=C(e,t,r.bottom),o=!1;function a(t){if("string"==typeof t)s.value=t;else{if(o)return;o=!0,x(e,i),e.state.dialog||e.focus(),r.onClose&&r.onClose(i)}}w(e,i);var s=i.getElementsByTagName("input")[0];return s&&(r.value&&(s.value=r.value,!1!==r.selectValueOnOpen&&s.select()),r.onInput&&y.on(s,"input",function(e){r.onInput(e,s.value,a)}),r.onKeyUp&&y.on(s,"keyup",function(e){r.onKeyUp(e,s.value,a)}),y.on(s,"keydown",function(e){r&&r.onKeyDown&&r.onKeyDown(e,s.value,a)||(13==e.keyCode&&n(s.value),(27==e.keyCode||!1!==r.closeOnEnter&&13==e.keyCode)&&(s.blur(),y.e_stop(e),a()))}),!1!==r.closeOnBlur&&y.on(s,"blur",function(){setTimeout(function(){document.activeElement!==s&&a()})}),s.focus()),a}(this,e,t,n)}openNotification(e,t){return function(e,t,n){k(e,s);var r,i=C(e,t,n&&n.bottom),o=!1,a=n&&void 0!==n.duration?n.duration:5e3;function s(){o||(o=!0,clearTimeout(r),i.remove(),x(e,i))}return i.onclick=function(e){e.preventDefault(),s()},w(e,i),a&&(r=setTimeout(s,a)),s}(this,e,t)}on(e,t){d(this,e,t)}off(e,t){m(this,e,t)}signal(e,t,n){p(this,e,t,n)}indexFromPos(e){return c(this.cm6.state.doc,e)}posFromIndex(e){return u(this.cm6.state.doc,e)}foldCode(e){let t=this.cm6,n=t.state.selection.ranges,r=c(this.cm6.state.doc,e),a=i.OF.create([i.OF.range(r,r)],0).ranges;t.state.selection.ranges=a,(0,o.Tm)(t),t.state.selection.ranges=n}firstLine(){return 0}lastLine(){return this.cm6.state.doc.lines-1}lineCount(){return this.cm6.state.doc.lines}setCursor(e,t){"object"==typeof e&&(t=e.ch,e=e.line);var n=c(this.cm6.state.doc,{line:e,ch:t||0});this.cm6.dispatch({selection:{anchor:n}},{scrollIntoView:!this.curOp}),this.curOp&&!this.curOp.isVimOp&&this.onBeforeEndOperation()}getCursor(e){var t=this.cm6.state.selection.main,n="head"!=e&&e?"anchor"==e?t.anchor:"start"==e?t.from:"end"==e?t.to:null:t.head;if(null==n)throw Error("Invalid cursor type");return this.posFromIndex(n)}listSelections(){var e=this.cm6.state.doc;return this.cm6.state.selection.ranges.map(t=>({anchor:u(e,t.anchor),head:u(e,t.head)}))}setSelections(e,t){var n=this.cm6.state.doc,r=e.map(e=>{var t=c(n,e.head),r=c(n,e.anchor);return t==r?i.OF.cursor(t,1):i.OF.range(r,t)});this.cm6.dispatch({selection:i.OF.create(r,t)})}setSelection(e,t,n){this.setSelections([{anchor:e,head:t}],0),n&&"*mouse"==n.origin&&this.onBeforeEndOperation()}getLine(e){var t=this.cm6.state.doc;return e<0||e>=t.lines?"":this.cm6.state.doc.line(e+1).text}getLineHandle(e){return this.$lineHandleChanges||(this.$lineHandleChanges=[]),{row:e,index:this.indexFromPos(new h(e,0))}}getLineNumber(e){var t=this.$lineHandleChanges;if(!t)return null;for(var n=e.index,r=0;r<t.length;r++)if(null==(n=t[r].changes.mapPos(n,1,i.iR.TrackAfter)))return null;var o=this.posFromIndex(n);return 0==o.ch?o.line:null}releaseLineHandles(){this.$lineHandleChanges=void 0}getRange(e,t){var n=this.cm6.state.doc;return this.cm6.state.sliceDoc(c(n,e),c(n,t))}replaceRange(e,t,n,r){n||(n=t);var i=this.cm6.state.doc;g(this,{changes:{from:c(i,t),to:c(i,n),insert:e}})}replaceSelection(e){g(this,this.cm6.state.replaceSelection(e))}replaceSelections(e){g(this,{changes:this.cm6.state.selection.ranges.map((t,n)=>({from:t.from,to:t.to,insert:e[n]||""}))})}getSelection(){return this.getSelections().join("\n")}getSelections(){var e=this.cm6;return e.state.selection.ranges.map(t=>e.state.sliceDoc(t.from,t.to))}somethingSelected(){return this.cm6.state.selection.ranges.some(e=>!e.empty)}getInputField(){return this.cm6.contentDOM}clipPos(e){var t=this.cm6.state.doc,n=e.ch,r=e.line+1;r<1&&(r=1,n=0),r>t.lines&&(r=t.lines,n=Number.MAX_VALUE);var i=t.line(r);return new h(r-1,n=Math.min(Math.max(0,n),i.to-i.from))}getValue(){return this.cm6.state.doc.toString()}setValue(e){var t=this.cm6;return t.dispatch({changes:{from:0,to:t.state.doc.length,insert:e},selection:i.OF.range(0,0)})}focus(){return this.cm6.focus()}blur(){return this.cm6.contentDOM.blur()}defaultTextHeight(){return this.cm6.defaultLineHeight}findMatchingBracket(e,t){var n=this.cm6.state,r=c(n.doc,e),i=(0,o.jU)(n,r+1,-1);return i&&i.end||(i=(0,o.jU)(n,r,1))&&i.end?{to:u(n.doc,i.end.from)}:{to:void 0}}scanForBracket(e,t,n,r){return function(e,t,n,r,i){for(var o=i&&i.maxScanLineLength||1e4,a=i&&i.maxScanLines||1e3,s=[],l=i&&i.bracketRegex||/[(){}[\]]/,c=n>0?Math.min(t.line+a,e.lastLine()+1):Math.max(e.firstLine()-1,t.line-a),u=t.line;u!=c;u+=n){var d=e.getLine(u);if(d){var m=n>0?0:d.length-1,p=n>0?d.length:-1;if(!(d.length>o))for(u==t.line&&(m=t.ch-(n<0?1:0));m!=p;m+=n){var f=d.charAt(m);if(l.test(f)){var g=S[f];if(g&&">"==g.charAt(1)==n>0)s.push(f);else{if(!s.length)return{pos:new h(u,m),ch:f};s.pop()}}}}}return u-n!=(n>0?e.lastLine():e.firstLine())&&null}(this,e,t,0,r)}indentLine(e,t){t?this.indentMore():this.indentLess()}indentMore(){(0,l.UY)(this.cm6)}indentLess(){(0,l.Mg)(this.cm6)}execCommand(e){if("indentAuto"==e)y.commands.indentAuto(this);else if("goLineLeft"==e)(0,l.My)(this.cm6);else if("goLineRight"==e){(0,l.oj)(this.cm6);let e=this.cm6.state,t=e.selection.main.head;t<e.doc.length&&"\n"!==e.sliceDoc(t,t+1)&&(0,l.Gv)(this.cm6)}else console.log(e+" is not implemented")}setBookmark(e,t){var n=(null==t?void 0:t.insertLeft)?1:-1;return new L(this,this.indexFromPos(e),n)}addOverlay({query:e}){let t=new s.L0({regexp:!0,search:e.source,caseSensitive:!/i/.test(e.flags)});if(t.valid){t.forVim=!0,this.cm6Query=t;let e=s.Ri.of(t);return this.cm6.dispatch({effects:e}),t}}removeOverlay(e){if(!this.cm6Query)return;this.cm6Query.forVim=!1;let t=s.Ri.of(this.cm6Query);this.cm6.dispatch({effects:t})}getSearchCursor(e,t){var n=this,r=null,i=null;void 0==t.ch&&(t.ch=Number.MAX_VALUE);var o=c(n.cm6.state.doc,t),a=e.source.replace(/(\\.|{(?:\d+(?:,\d*)?|,\d+)})|[{}]/g,function(e,t){return t||"\\"+e});function l(t,n=0,r=t.length){return new s.oW(t,a,{ignoreCase:e.ignoreCase},n,r)}return{findNext:function(){return this.find(!1)},findPrevious:function(){return this.find(!0)},find:function(e){var t=n.cm6.state.doc;return i=(r=e?function(e,t){var r=n.cm6.state.doc;for(let e=1;;e++){let n=Math.max(0,t-1e4*e),i=l(r,n,t),o=null;for(;!i.next().done;)o=i.value;if(o&&(0==n||o.from>n+10))return o;if(0==n)return null}}(0,r?r.from==r.to?r.to-1:r.from:o):function(e){var t=n.cm6.state.doc;if(e>t.length)return null;let r=l(t,e).next();return r.done?null:r.value}(r?r.from==r.to?r.to+1:r.to:o))&&{from:u(t,r.from),to:u(t,r.to),match:r.match},r&&r.match},from:function(){return null==i?void 0:i.from},to:function(){return null==i?void 0:i.to},replace:function(e){r&&(g(n,{changes:{from:r.from,to:r.to,insert:e}}),r.to=r.from+e.length,i&&(i.to=u(n.cm6.state.doc,r.to)))}}}findPosV(e,t,n,r){let{cm6:o}=this,a=o.state.doc,s="page"==n?o.dom.clientHeight:0,l=c(a,e),h=i.OF.cursor(l,1,void 0,r),d=Math.round(Math.abs(t));for(let e=0;e<d;e++)"page"==n?h=o.moveVertically(h,t>0,s):"line"==n&&(h=o.moveVertically(h,t>0));let m=u(a,h.head);return(t<0&&0==h.head&&0!=r&&0==e.line&&0!=e.ch||t>0&&h.head==a.length&&m.ch!=r&&e.line==m.line)&&(m.hitSide=!0),m}charCoords(e,t){var n=this.cm6.contentDOM.getBoundingClientRect(),r=c(this.cm6.state.doc,e),i=this.cm6.coordsAtPos(r),o=-n.top;return{left:((null==i?void 0:i.left)||0)-n.left,top:((null==i?void 0:i.top)||0)+o,bottom:((null==i?void 0:i.bottom)||0)+o}}coordsChar(e,t){var n=this.cm6.contentDOM.getBoundingClientRect(),r=this.cm6.posAtCoords({x:e.left+n.left,y:e.top+n.top})||0;return u(this.cm6.state.doc,r)}getScrollInfo(){var e=this.cm6.scrollDOM;return{left:e.scrollLeft,top:e.scrollTop,height:e.scrollHeight,width:e.scrollWidth,clientHeight:e.clientHeight,clientWidth:e.clientWidth}}scrollTo(e,t){null!=e&&(this.cm6.scrollDOM.scrollLeft=e),null!=t&&(this.cm6.scrollDOM.scrollTop=t)}scrollIntoView(e,t){if(e){var n=this.indexFromPos(e);this.cm6.dispatch({effects:a.Lz.scrollIntoView(n)})}else this.cm6.dispatch({scrollIntoView:!0,userEvent:"scroll"})}getWrapperElement(){return this.cm6.dom}getMode(){return{name:this.getOption("mode")}}setSize(e,t){this.cm6.dom.style.width=e+4+"px",this.cm6.dom.style.height=t+"px",this.refresh()}refresh(){this.cm6.measure()}destroy(){this.removeOverlay()}getLastEditEnd(){return this.posFromIndex(this.$lastChangeEndOffset)}onChange(e){for(let t in this.$lineHandleChanges&&this.$lineHandleChanges.push(e),this.marks)this.marks[t].update(e.changes);this.virtualSelection&&(this.virtualSelection.ranges=this.virtualSelection.ranges.map(t=>t.map(e.changes)));var t=this.curOp=this.curOp||{};e.changes.iterChanges((e,n,r,i,o)=>{(null==t.$changeStart||t.$changeStart>r)&&(t.$changeStart=r),this.$lastChangeEndOffset=i;var a={text:o.toJSON()};t.lastChange?t.lastChange.next=t.lastChange=a:t.lastChange=t.change=a},!0),t.changeHandlers||(t.changeHandlers=this._handlers.change&&this._handlers.change.slice())}onSelectionChange(){var e=this.curOp=this.curOp||{};e.cursorActivityHandlers||(e.cursorActivityHandlers=this._handlers.cursorActivity&&this._handlers.cursorActivity.slice()),this.curOp.cursorActivity=!0}operation(e,t){this.curOp||(this.curOp={$d:0}),this.curOp.$d++;try{var n=e()}finally{this.curOp&&(this.curOp.$d--,this.curOp.$d||this.onBeforeEndOperation())}return n}onBeforeEndOperation(){var e=this.curOp,t=!1;e&&(e.change&&f(e.changeHandlers,this,e.change),e&&e.cursorActivity&&(f(e.cursorActivityHandlers,this,null),e.isVimOp&&(t=!0)),this.curOp=null),t&&this.scrollIntoView()}moveH(e,t){if("char"==t){var n=this.getCursor();this.setCursor(n.line,n.ch+e)}}setOption(e,t){switch(e){case"keyMap":this.state.keyMap=t;break;case"textwidth":this.state.textwidth=t}}getOption(e){switch(e){case"firstLineNumber":return 1;case"tabSize":return this.cm6.state.tabSize||4;case"readOnly":return this.cm6.state.readOnly;case"indentWithTabs":return"	"==this.cm6.state.facet(o.Xt);case"indentUnit":return this.cm6.state.facet(o.Xt).length||2;case"textwidth":return this.state.textwidth;case"keyMap":return this.state.keyMap||"vim"}}toggleOverwrite(e){this.state.overwrite=e}getTokenTypeAt(e){var t,n=this.indexFromPos(e),r=(0,o.a_)(this.cm6.state,n),i=null==r?void 0:r.resolve(n),a=(null===(t=null==i?void 0:i.type)||void 0===t?void 0:t.name)||"";return/comment/i.test(a)?"comment":/string/i.test(a)?"string":""}overWriteSelection(e){var t=this.cm6.state.doc,n=this.cm6.state.selection,r=n.ranges.map(e=>{if(e.empty){var n=e.to<t.length?t.sliceString(e.from,e.to+1):"";if(n&&!/\n/.test(n))return i.OF.range(e.from,e.to+1)}return e});this.cm6.dispatch({selection:i.OF.create(r,n.mainIndex)}),this.replaceSelection(e)}isInMultiSelectMode(){return this.cm6.state.selection.ranges.length>1}virtualSelectionMode(){return!!this.virtualSelection}forEachSelection(e){var t=this.cm6.state.selection;this.virtualSelection=i.OF.create(t.ranges,t.mainIndex);for(var n=0;n<this.virtualSelection.ranges.length;n++){var r=this.virtualSelection.ranges[n];r&&(this.cm6.dispatch({selection:i.OF.create([r])}),e(),this.virtualSelection.ranges[n]=this.cm6.state.selection.ranges[0])}this.cm6.dispatch({selection:this.virtualSelection}),this.virtualSelection=null}hardWrap(e){return function(e,t){for(var n,r=t.column||e.getOption("textwidth")||80,i=!1!=t.allowMerge,o=Math.min(t.from,t.to),a=Math.max(t.from,t.to);o<=a;){var s=e.getLine(o);if(s.length>r){var l=f(s,r,5);if(l){var c=null===(n=/^\s*/.exec(s))||void 0===n?void 0:n[0];e.replaceRange("\n"+c,new h(o,l.start),new h(o,l.end))}a++}else if(i&&/\S/.test(s)&&o!=a){var u=e.getLine(o+1);if(u&&/\S/.test(u)){var d=s.replace(/\s+$/,""),m=u.replace(/^\s+/,""),p=d+" "+m,l=f(p,r,5);l&&l.start>d.length||p.length<r?(e.replaceRange(" ",new h(o,d.length),new h(o+1,u.length-m.length)),o--,a--):d.length<s.length&&e.replaceRange("",new h(o,d.length),new h(o,s.length))}}o++}return o;function f(e,t,n){if(!(e.length<t)){var r=e.slice(0,t),i=e.slice(t),o=/^(?:(\s+)|(\S+)(\s+))/.exec(i),a=/(?:(\s+)|(\s+)(\S+))$/.exec(r),s=0,l=0;if(a&&!a[2]&&(s=t-a[1].length,l=t),o&&!o[2]&&(s||(s=t),l=t+o[1].length),s)return{start:s,end:l};if(a&&a[2]&&a.index>n)return{start:a.index,end:a.index+a[2].length};if(o&&o[2])return{start:s=t+o[2].length,end:s+o[3].length}}}}(this,e)}}function C(e,t,n){var r=document.createElement("div");return r.appendChild(t),r}function k(e,t){e.state.currentNotificationClose&&e.state.currentNotificationClose(),e.state.currentNotificationClose=t}function w(e,t){var n=e.state.dialog;e.state.dialog=t,t&&n!==t&&(n&&n.contains(document.activeElement)&&e.focus(),n&&n.parentElement?n.parentElement.replaceChild(t,n):n&&n.remove(),y.signal(e,"dialog"))}function x(e,t){e.state.dialog==t&&(e.state.dialog=null,y.signal(e,"dialog"))}y.isMac="undefined"!=typeof navigator&&/Mac/.test(navigator.platform),y.Pos=h,y.StringStream=o.Kw,y.commands={cursorCharLeft:function(e){(0,l.Cv)(e.cm6)},redo:function(e){v(e,!1)},undo:function(e){v(e,!0)},newlineAndIndent:function(e){(0,l.Bn)({state:e.cm6.state,dispatch:t=>g(e,t)})},indentAuto:function(e){(0,l.RJ)(e.cm6)},newlineAndIndentContinueComment:void 0,save:void 0},y.isWordChar=function(e){return r.test(e)},y.keys={},y.addClass=function(e,t){},y.rmClass=function(e,t){},y.e_preventDefault=function(e){e.preventDefault()},y.e_stop=function(e){var t,n;null===(t=null==e?void 0:e.stopPropagation)||void 0===t||t.call(e),null===(n=null==e?void 0:e.preventDefault)||void 0===n||n.call(e)},y.lookupKey=function(e,t,n){var r=y.keys[e];r&&n(r)},y.on=d,y.off=m,y.signal=p,y.findMatchingTag=function(e,t){},y.findEnclosingTag=function(e,t){var n,r,i=e.cm6.state,a=e.indexFromPos(t);a<i.doc.length&&"<"==i.sliceDoc(a,a+1)&&a++;for(var s=(0,o.a_)(i,a),l=(null==s?void 0:s.resolve(a))||null;l;){if((null===(n=l.firstChild)||void 0===n?void 0:n.type.name)=="OpenTag"&&(null===(r=l.lastChild)||void 0===r?void 0:r.type.name)=="CloseTag")return{open:M(i.doc,l.firstChild),close:M(i.doc,l.lastChild)};l=l.parent}},y.keyName=void 0;var S={"(":")>",")":"(<","[":"]>","]":"[<","{":"}>","}":"{<","<":">>",">":"<<"};function M(e,t){return{from:u(e,t.from),to:u(e,t.to)}}class L{constructor(e,t,n){this.cm=e,this.id=e.$mid++,this.offset=t,this.assoc=n,e.marks[this.id]=this}clear(){delete this.cm.marks[this.id]}find(){return null==this.offset?null:this.cm.posFromIndex(this.offset)}update(e){null!=this.offset&&(this.offset=e.mapPos(this.offset,this.assoc,i.iR.TrackDel))}}let b=a.$G||function(){let e={cursorBlinkRate:1200};return function(){return e}}();class A{constructor(e,t,n,r,i,o,a,s,l,c){this.left=e,this.top=t,this.height=n,this.fontFamily=r,this.fontSize=i,this.fontWeight=o,this.color=a,this.className=s,this.letter=l,this.partial=c}draw(){let e=document.createElement("div");return e.className=this.className,this.adjust(e),e}adjust(e){e.style.left=this.left+"px",e.style.top=this.top+"px",e.style.height=this.height+"px",e.style.lineHeight=this.height+"px",e.style.fontFamily=this.fontFamily,e.style.fontSize=this.fontSize,e.style.fontWeight=this.fontWeight,e.style.color=this.partial?"transparent":this.color,e.className=this.className,e.textContent=this.letter}eq(e){return this.left==e.left&&this.top==e.top&&this.height==e.height&&this.fontFamily==e.fontFamily&&this.fontSize==e.fontSize&&this.fontWeight==e.fontWeight&&this.color==e.color&&this.className==e.className&&this.letter==e.letter}}class O{constructor(e,t){this.view=e,this.rangePieces=[],this.cursors=[],this.cm=t,this.measureReq={read:this.readPos.bind(this),write:this.drawSel.bind(this)},this.cursorLayer=e.scrollDOM.appendChild(document.createElement("div")),this.cursorLayer.className="cm-cursorLayer cm-vimCursorLayer",this.cursorLayer.setAttribute("aria-hidden","true"),e.requestMeasure(this.measureReq),this.setBlinkRate()}setBlinkRate(){let e=b(this.cm.cm6.state).cursorBlinkRate;this.cursorLayer.style.animationDuration=e+"ms"}update(e){(e.selectionSet||e.geometryChanged||e.viewportChanged)&&(this.view.requestMeasure(this.measureReq),this.cursorLayer.style.animationName="cm-blink"==this.cursorLayer.style.animationName?"cm-blink2":"cm-blink"),b(e.startState)!=b(e.state)&&this.setBlinkRate()}scheduleRedraw(){this.view.requestMeasure(this.measureReq)}readPos(){let{state:e}=this.view,t=[];for(let n of e.selection.ranges){let r=n==e.selection.main,i=function(e,t,n,r){var i;let o=n.head,s=!1,l=1,c=e.state.vim;if(c&&(!c.insertMode||e.state.overwrite)){if(s=!0,c.visualBlock&&!r)return null;n.anchor<n.head&&o--,e.state.overwrite?l=.2:c.status&&(l=.5)}if(!s)return null;{let e,n=o<t.state.doc.length&&t.state.sliceDoc(o,o+1);n&&/[\uDC00-\uDFFF]/.test(n)&&o>1&&(o--,n=t.state.sliceDoc(o,o+1));let s=t.coordsAtPos(o,1);if(!s)return null;let c=(e=t.scrollDOM.getBoundingClientRect(),{left:(t.textDirection==a.OP.LTR?e.left:e.right-t.scrollDOM.clientWidth)-t.scrollDOM.scrollLeft,top:e.top-t.scrollDOM.scrollTop}),h=t.domAtPos(o),d=h?h.node:t.contentDOM;for(;h&&h.node instanceof HTMLElement;)d=h.node,h={node:h.node.childNodes[h.offset],offset:0};if(!(d instanceof HTMLElement)){if(!d.parentNode)return null;d=d.parentNode}let m=getComputedStyle(d),p=s.left,f=null===(i=t.coordsForChar)||void 0===i?void 0:i.call(t,o);if(f&&(p=f.left),n&&"\n"!=n&&"\r"!=n){if("	"==n){n="\xa0";var u=t.coordsAtPos(o+1,-1);u&&(p=u.left-(u.left-s.left)/parseInt(m.tabSize))}else/[\uD800-\uDBFF]/.test(n)&&o<t.state.doc.length-1&&(n+=t.state.sliceDoc(o+1,o+2))}else n="\xa0";let g=s.bottom-s.top;return new A(p-c.left,s.top-c.top+g*(1-l),g*l,m.fontFamily,m.fontSize,m.fontWeight,m.color,r?"cm-fat-cursor cm-cursor-primary":"cm-fat-cursor cm-cursor-secondary",n,1!=l)}}(this.cm,this.view,n,r);i&&t.push(i)}return{cursors:t}}drawSel({cursors:e}){if(e.length!=this.cursors.length||e.some((e,t)=>!e.eq(this.cursors[t]))){let t=this.cursorLayer.children;if(t.length!==e.length)for(let t of(this.cursorLayer.textContent="",e))this.cursorLayer.appendChild(t.draw());else e.forEach((e,n)=>e.adjust(t[n]));this.cursors=e}}destroy(){this.cursorLayer.remove()}}let E=i.Nb.highest(a.Lz.theme({".cm-vimMode .cm-line":{"& ::selection":{backgroundColor:"transparent !important"},"&::selection":{backgroundColor:"transparent !important"},caretColor:"transparent !important"},".cm-fat-cursor":{position:"absolute",background:"#ff9696",border:"none",whiteSpace:"pre"},"&:not(.cm-focused) .cm-fat-cursor":{background:"none",outline:"solid 1px #ff9696",color:"transparent !important"}}));var T="undefined"!=typeof navigator&&/linux/i.test(navigator.platform)&&/ Gecko\/\d+/.exec(navigator.userAgent);let R=function(e){var t,n,r,i,o=e.Pos;function a(e,t,n){if(t.line===n.line&&t.ch>=n.ch-1){var r=e.getLine(t.line).charCodeAt(t.ch);55296<=r&&r<=55551&&(n.ch+=1)}return{start:t,end:n}}var s=[{keys:"<Left>",type:"keyToKey",toKeys:"h"},{keys:"<Right>",type:"keyToKey",toKeys:"l"},{keys:"<Up>",type:"keyToKey",toKeys:"k"},{keys:"<Down>",type:"keyToKey",toKeys:"j"},{keys:"g<Up>",type:"keyToKey",toKeys:"gk"},{keys:"g<Down>",type:"keyToKey",toKeys:"gj"},{keys:"<Space>",type:"keyToKey",toKeys:"l"},{keys:"<BS>",type:"keyToKey",toKeys:"h"},{keys:"<Del>",type:"keyToKey",toKeys:"x"},{keys:"<C-Space>",type:"keyToKey",toKeys:"W"},{keys:"<C-BS>",type:"keyToKey",toKeys:"B"},{keys:"<S-Space>",type:"keyToKey",toKeys:"w"},{keys:"<S-BS>",type:"keyToKey",toKeys:"b"},{keys:"<C-n>",type:"keyToKey",toKeys:"j"},{keys:"<C-p>",type:"keyToKey",toKeys:"k"},{keys:"<C-[>",type:"keyToKey",toKeys:"<Esc>"},{keys:"<C-c>",type:"keyToKey",toKeys:"<Esc>"},{keys:"<C-[>",type:"keyToKey",toKeys:"<Esc>",context:"insert"},{keys:"<C-c>",type:"keyToKey",toKeys:"<Esc>",context:"insert"},{keys:"<C-Esc>",type:"keyToKey",toKeys:"<Esc>"},{keys:"<C-Esc>",type:"keyToKey",toKeys:"<Esc>",context:"insert"},{keys:"s",type:"keyToKey",toKeys:"cl",context:"normal"},{keys:"s",type:"keyToKey",toKeys:"c",context:"visual"},{keys:"S",type:"keyToKey",toKeys:"cc",context:"normal"},{keys:"S",type:"keyToKey",toKeys:"VdO",context:"visual"},{keys:"<Home>",type:"keyToKey",toKeys:"0"},{keys:"<End>",type:"keyToKey",toKeys:"$"},{keys:"<PageUp>",type:"keyToKey",toKeys:"<C-b>"},{keys:"<PageDown>",type:"keyToKey",toKeys:"<C-f>"},{keys:"<CR>",type:"keyToKey",toKeys:"j^",context:"normal"},{keys:"<Ins>",type:"keyToKey",toKeys:"i",context:"normal"},{keys:"<Ins>",type:"action",action:"toggleOverwrite",context:"insert"},{keys:"H",type:"motion",motion:"moveToTopLine",motionArgs:{linewise:!0,toJumplist:!0}},{keys:"M",type:"motion",motion:"moveToMiddleLine",motionArgs:{linewise:!0,toJumplist:!0}},{keys:"L",type:"motion",motion:"moveToBottomLine",motionArgs:{linewise:!0,toJumplist:!0}},{keys:"h",type:"motion",motion:"moveByCharacters",motionArgs:{forward:!1}},{keys:"l",type:"motion",motion:"moveByCharacters",motionArgs:{forward:!0}},{keys:"j",type:"motion",motion:"moveByLines",motionArgs:{forward:!0,linewise:!0}},{keys:"k",type:"motion",motion:"moveByLines",motionArgs:{forward:!1,linewise:!0}},{keys:"gj",type:"motion",motion:"moveByDisplayLines",motionArgs:{forward:!0}},{keys:"gk",type:"motion",motion:"moveByDisplayLines",motionArgs:{forward:!1}},{keys:"w",type:"motion",motion:"moveByWords",motionArgs:{forward:!0,wordEnd:!1}},{keys:"W",type:"motion",motion:"moveByWords",motionArgs:{forward:!0,wordEnd:!1,bigWord:!0}},{keys:"e",type:"motion",motion:"moveByWords",motionArgs:{forward:!0,wordEnd:!0,inclusive:!0}},{keys:"E",type:"motion",motion:"moveByWords",motionArgs:{forward:!0,wordEnd:!0,bigWord:!0,inclusive:!0}},{keys:"b",type:"motion",motion:"moveByWords",motionArgs:{forward:!1,wordEnd:!1}},{keys:"B",type:"motion",motion:"moveByWords",motionArgs:{forward:!1,wordEnd:!1,bigWord:!0}},{keys:"ge",type:"motion",motion:"moveByWords",motionArgs:{forward:!1,wordEnd:!0,inclusive:!0}},{keys:"gE",type:"motion",motion:"moveByWords",motionArgs:{forward:!1,wordEnd:!0,bigWord:!0,inclusive:!0}},{keys:"{",type:"motion",motion:"moveByParagraph",motionArgs:{forward:!1,toJumplist:!0}},{keys:"}",type:"motion",motion:"moveByParagraph",motionArgs:{forward:!0,toJumplist:!0}},{keys:"(",type:"motion",motion:"moveBySentence",motionArgs:{forward:!1}},{keys:")",type:"motion",motion:"moveBySentence",motionArgs:{forward:!0}},{keys:"<C-f>",type:"motion",motion:"moveByPage",motionArgs:{forward:!0}},{keys:"<C-b>",type:"motion",motion:"moveByPage",motionArgs:{forward:!1}},{keys:"<C-d>",type:"motion",motion:"moveByScroll",motionArgs:{forward:!0,explicitRepeat:!0}},{keys:"<C-u>",type:"motion",motion:"moveByScroll",motionArgs:{forward:!1,explicitRepeat:!0}},{keys:"gg",type:"motion",motion:"moveToLineOrEdgeOfDocument",motionArgs:{forward:!1,explicitRepeat:!0,linewise:!0,toJumplist:!0}},{keys:"G",type:"motion",motion:"moveToLineOrEdgeOfDocument",motionArgs:{forward:!0,explicitRepeat:!0,linewise:!0,toJumplist:!0}},{keys:"g$",type:"motion",motion:"moveToEndOfDisplayLine"},{keys:"g^",type:"motion",motion:"moveToStartOfDisplayLine"},{keys:"g0",type:"motion",motion:"moveToStartOfDisplayLine"},{keys:"0",type:"motion",motion:"moveToStartOfLine"},{keys:"^",type:"motion",motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:"+",type:"motion",motion:"moveByLines",motionArgs:{forward:!0,toFirstChar:!0}},{keys:"-",type:"motion",motion:"moveByLines",motionArgs:{forward:!1,toFirstChar:!0}},{keys:"_",type:"motion",motion:"moveByLines",motionArgs:{forward:!0,toFirstChar:!0,repeatOffset:-1}},{keys:"$",type:"motion",motion:"moveToEol",motionArgs:{inclusive:!0}},{keys:"%",type:"motion",motion:"moveToMatchedSymbol",motionArgs:{inclusive:!0,toJumplist:!0}},{keys:"f<character>",type:"motion",motion:"moveToCharacter",motionArgs:{forward:!0,inclusive:!0}},{keys:"F<character>",type:"motion",motion:"moveToCharacter",motionArgs:{forward:!1}},{keys:"t<character>",type:"motion",motion:"moveTillCharacter",motionArgs:{forward:!0,inclusive:!0}},{keys:"T<character>",type:"motion",motion:"moveTillCharacter",motionArgs:{forward:!1}},{keys:";",type:"motion",motion:"repeatLastCharacterSearch",motionArgs:{forward:!0}},{keys:",",type:"motion",motion:"repeatLastCharacterSearch",motionArgs:{forward:!1}},{keys:"'<register>",type:"motion",motion:"goToMark",motionArgs:{toJumplist:!0,linewise:!0}},{keys:"`<register>",type:"motion",motion:"goToMark",motionArgs:{toJumplist:!0}},{keys:"]`",type:"motion",motion:"jumpToMark",motionArgs:{forward:!0}},{keys:"[`",type:"motion",motion:"jumpToMark",motionArgs:{forward:!1}},{keys:"]'",type:"motion",motion:"jumpToMark",motionArgs:{forward:!0,linewise:!0}},{keys:"['",type:"motion",motion:"jumpToMark",motionArgs:{forward:!1,linewise:!0}},{keys:"]p",type:"action",action:"paste",isEdit:!0,actionArgs:{after:!0,isEdit:!0,matchIndent:!0}},{keys:"[p",type:"action",action:"paste",isEdit:!0,actionArgs:{after:!1,isEdit:!0,matchIndent:!0}},{keys:"]<character>",type:"motion",motion:"moveToSymbol",motionArgs:{forward:!0,toJumplist:!0}},{keys:"[<character>",type:"motion",motion:"moveToSymbol",motionArgs:{forward:!1,toJumplist:!0}},{keys:"|",type:"motion",motion:"moveToColumn"},{keys:"o",type:"motion",motion:"moveToOtherHighlightedEnd",context:"visual"},{keys:"O",type:"motion",motion:"moveToOtherHighlightedEnd",motionArgs:{sameLine:!0},context:"visual"},{keys:"d",type:"operator",operator:"delete"},{keys:"y",type:"operator",operator:"yank"},{keys:"c",type:"operator",operator:"change"},{keys:"=",type:"operator",operator:"indentAuto"},{keys:">",type:"operator",operator:"indent",operatorArgs:{indentRight:!0}},{keys:"<",type:"operator",operator:"indent",operatorArgs:{indentRight:!1}},{keys:"g~",type:"operator",operator:"changeCase"},{keys:"gu",type:"operator",operator:"changeCase",operatorArgs:{toLower:!0},isEdit:!0},{keys:"gU",type:"operator",operator:"changeCase",operatorArgs:{toLower:!1},isEdit:!0},{keys:"n",type:"motion",motion:"findNext",motionArgs:{forward:!0,toJumplist:!0}},{keys:"N",type:"motion",motion:"findNext",motionArgs:{forward:!1,toJumplist:!0}},{keys:"gn",type:"motion",motion:"findAndSelectNextInclusive",motionArgs:{forward:!0}},{keys:"gN",type:"motion",motion:"findAndSelectNextInclusive",motionArgs:{forward:!1}},{keys:"gq",type:"operator",operator:"hardWrap"},{keys:"gw",type:"operator",operator:"hardWrap",operatorArgs:{keepCursor:!0}},{keys:"x",type:"operatorMotion",operator:"delete",motion:"moveByCharacters",motionArgs:{forward:!0},operatorMotionArgs:{visualLine:!1}},{keys:"X",type:"operatorMotion",operator:"delete",motion:"moveByCharacters",motionArgs:{forward:!1},operatorMotionArgs:{visualLine:!0}},{keys:"D",type:"operatorMotion",operator:"delete",motion:"moveToEol",motionArgs:{inclusive:!0},context:"normal"},{keys:"D",type:"operator",operator:"delete",operatorArgs:{linewise:!0},context:"visual"},{keys:"Y",type:"operatorMotion",operator:"yank",motion:"expandToLine",motionArgs:{linewise:!0},context:"normal"},{keys:"Y",type:"operator",operator:"yank",operatorArgs:{linewise:!0},context:"visual"},{keys:"C",type:"operatorMotion",operator:"change",motion:"moveToEol",motionArgs:{inclusive:!0},context:"normal"},{keys:"C",type:"operator",operator:"change",operatorArgs:{linewise:!0},context:"visual"},{keys:"~",type:"operatorMotion",operator:"changeCase",motion:"moveByCharacters",motionArgs:{forward:!0},operatorArgs:{shouldMoveCursor:!0},context:"normal"},{keys:"~",type:"operator",operator:"changeCase",context:"visual"},{keys:"<C-u>",type:"operatorMotion",operator:"delete",motion:"moveToStartOfLine",context:"insert"},{keys:"<C-w>",type:"operatorMotion",operator:"delete",motion:"moveByWords",motionArgs:{forward:!1,wordEnd:!1},context:"insert"},{keys:"<C-w>",type:"idle",context:"normal"},{keys:"<C-i>",type:"action",action:"jumpListWalk",actionArgs:{forward:!0}},{keys:"<C-o>",type:"action",action:"jumpListWalk",actionArgs:{forward:!1}},{keys:"<C-e>",type:"action",action:"scroll",actionArgs:{forward:!0,linewise:!0}},{keys:"<C-y>",type:"action",action:"scroll",actionArgs:{forward:!1,linewise:!0}},{keys:"a",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"charAfter"},context:"normal"},{keys:"A",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"eol"},context:"normal"},{keys:"A",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"endOfSelectedArea"},context:"visual"},{keys:"i",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"inplace"},context:"normal"},{keys:"gi",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"lastEdit"},context:"normal"},{keys:"I",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"firstNonBlank"},context:"normal"},{keys:"gI",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"bol"},context:"normal"},{keys:"I",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"startOfSelectedArea"},context:"visual"},{keys:"o",type:"action",action:"newLineAndEnterInsertMode",isEdit:!0,interlaceInsertRepeat:!0,actionArgs:{after:!0},context:"normal"},{keys:"O",type:"action",action:"newLineAndEnterInsertMode",isEdit:!0,interlaceInsertRepeat:!0,actionArgs:{after:!1},context:"normal"},{keys:"v",type:"action",action:"toggleVisualMode"},{keys:"V",type:"action",action:"toggleVisualMode",actionArgs:{linewise:!0}},{keys:"<C-v>",type:"action",action:"toggleVisualMode",actionArgs:{blockwise:!0}},{keys:"<C-q>",type:"action",action:"toggleVisualMode",actionArgs:{blockwise:!0}},{keys:"gv",type:"action",action:"reselectLastSelection"},{keys:"J",type:"action",action:"joinLines",isEdit:!0},{keys:"gJ",type:"action",action:"joinLines",actionArgs:{keepSpaces:!0},isEdit:!0},{keys:"p",type:"action",action:"paste",isEdit:!0,actionArgs:{after:!0,isEdit:!0}},{keys:"P",type:"action",action:"paste",isEdit:!0,actionArgs:{after:!1,isEdit:!0}},{keys:"r<character>",type:"action",action:"replace",isEdit:!0},{keys:"@<register>",type:"action",action:"replayMacro"},{keys:"q<register>",type:"action",action:"enterMacroRecordMode"},{keys:"R",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{replace:!0},context:"normal"},{keys:"R",type:"operator",operator:"change",operatorArgs:{linewise:!0,fullLine:!0},context:"visual",exitVisualBlock:!0},{keys:"u",type:"action",action:"undo",context:"normal"},{keys:"u",type:"operator",operator:"changeCase",operatorArgs:{toLower:!0},context:"visual",isEdit:!0},{keys:"U",type:"operator",operator:"changeCase",operatorArgs:{toLower:!1},context:"visual",isEdit:!0},{keys:"<C-r>",type:"action",action:"redo"},{keys:"m<register>",type:"action",action:"setMark"},{keys:'"<register>',type:"action",action:"setRegister"},{keys:"<C-r><register>",type:"action",action:"insertRegister",context:"insert",isEdit:!0},{keys:"<C-o>",type:"action",action:"oneNormalCommand",context:"insert"},{keys:"zz",type:"action",action:"scrollToCursor",actionArgs:{position:"center"}},{keys:"z.",type:"action",action:"scrollToCursor",actionArgs:{position:"center"},motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:"zt",type:"action",action:"scrollToCursor",actionArgs:{position:"top"}},{keys:"z<CR>",type:"action",action:"scrollToCursor",actionArgs:{position:"top"},motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:"zb",type:"action",action:"scrollToCursor",actionArgs:{position:"bottom"}},{keys:"z-",type:"action",action:"scrollToCursor",actionArgs:{position:"bottom"},motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:".",type:"action",action:"repeatLastEdit"},{keys:"<C-a>",type:"action",action:"incrementNumberToken",isEdit:!0,actionArgs:{increase:!0,backtrack:!1}},{keys:"<C-x>",type:"action",action:"incrementNumberToken",isEdit:!0,actionArgs:{increase:!1,backtrack:!1}},{keys:"<C-t>",type:"action",action:"indent",actionArgs:{indentRight:!0},context:"insert"},{keys:"<C-d>",type:"action",action:"indent",actionArgs:{indentRight:!1},context:"insert"},{keys:"a<register>",type:"motion",motion:"textObjectManipulation"},{keys:"i<register>",type:"motion",motion:"textObjectManipulation",motionArgs:{textObjectInner:!0}},{keys:"/",type:"search",searchArgs:{forward:!0,querySrc:"prompt",toJumplist:!0}},{keys:"?",type:"search",searchArgs:{forward:!1,querySrc:"prompt",toJumplist:!0}},{keys:"*",type:"search",searchArgs:{forward:!0,querySrc:"wordUnderCursor",wholeWordOnly:!0,toJumplist:!0}},{keys:"#",type:"search",searchArgs:{forward:!1,querySrc:"wordUnderCursor",wholeWordOnly:!0,toJumplist:!0}},{keys:"g*",type:"search",searchArgs:{forward:!0,querySrc:"wordUnderCursor",toJumplist:!0}},{keys:"g#",type:"search",searchArgs:{forward:!1,querySrc:"wordUnderCursor",toJumplist:!0}},{keys:":",type:"ex"}],l=s.length,c=[{name:"colorscheme",shortName:"colo"},{name:"map"},{name:"imap",shortName:"im"},{name:"nmap",shortName:"nm"},{name:"vmap",shortName:"vm"},{name:"omap",shortName:"om"},{name:"noremap",shortName:"no"},{name:"nnoremap",shortName:"nn"},{name:"vnoremap",shortName:"vn"},{name:"inoremap",shortName:"ino"},{name:"onoremap",shortName:"ono"},{name:"unmap"},{name:"mapclear",shortName:"mapc"},{name:"nmapclear",shortName:"nmapc"},{name:"vmapclear",shortName:"vmapc"},{name:"imapclear",shortName:"imapc"},{name:"omapclear",shortName:"omapc"},{name:"write",shortName:"w"},{name:"undo",shortName:"u"},{name:"redo",shortName:"red"},{name:"set",shortName:"se"},{name:"setlocal",shortName:"setl"},{name:"setglobal",shortName:"setg"},{name:"sort",shortName:"sor"},{name:"substitute",shortName:"s",possiblyAsync:!0},{name:"startinsert",shortName:"start"},{name:"nohlsearch",shortName:"noh"},{name:"yank",shortName:"y"},{name:"delmarks",shortName:"delm"},{name:"registers",shortName:"reg",excludeFromCommandHistory:!0},{name:"vglobal",shortName:"v"},{name:"delete",shortName:"d"},{name:"join",shortName:"j"},{name:"normal",shortName:"norm"},{name:"global",shortName:"g"}],u=j("");function h(e){var t=e.state.vim;return t.onPasteFn||(t.onPasteFn=function(){t.insertMode||(e.setCursor(et(e.getCursor(),0,1)),G.enterInsertMode(e,{},t))}),t.onPasteFn}var d=/[\d]/,m=[e.isWordChar,function(t){return t&&!e.isWordChar(t)&&!/\s/.test(t)}],p=[function(e){return/\S/.test(e)}],f=["<",">"],g=["-",'"',".",":","_","/","+"],v=/^\w$/;try{t=RegExp("^[\\p{Lu}]$","u")}catch(e){t=/^[A-Z]$/}function y(e,t){return t>=e.firstLine()&&t<=e.lastLine()}function C(e){return/^[a-z]$/.test(e)}function k(e){return/^\s*$/.test(e)}function w(e){return -1!=".?!".indexOf(e)}function x(e,t){for(var n=0;n<t.length;n++)if(t[n]==e)return!0;return!1}var S={};function M(e,t,n,r,i){if(void 0===t&&!i)throw Error("defaultValue is required unless callback is provided");if(n||(n="string"),S[e]={type:n,defaultValue:t,callback:i},r)for(var o=0;o<r.length;o++)S[r[o]]=S[e];t&&L(e,t)}function L(e,t,n,r){var i=S[e],o=(r=r||{}).scope;if(!i)return Error("Unknown option: "+e);if("boolean"==i.type){if(t&&!0!==t)return Error("Invalid argument: "+e+"="+t);!1!==t&&(t=!0)}i.callback?("local"!==o&&i.callback(t,void 0),"global"!==o&&n&&i.callback(t,n)):("local"!==o&&(i.value="boolean"==i.type?!!t:t),"global"!==o&&n&&(n.state.vim.options[e]={value:t}))}function b(e,t,n){var r=S[e],i=(n=n||{}).scope;if(!r)return Error("Unknown option: "+e);if(!r.callback)return("global"!==i&&t&&t.state.vim.options[e]||"local"!==i&&r||{}).value;{let e=t&&r.callback(void 0,t);return"global"!==i&&void 0!==e?e:"local"!==i?r.callback():void 0}}M("filetype",void 0,"string",["ft"],function(e,t){if(void 0!==t){if(void 0===e){let e=t.getOption("mode");return"null"==e?"":e}t.setOption("mode",""==e?"null":e)}}),M("textwidth",80,"number",["tw"],function(e,t){if(void 0!==t){if(void 0===e)return t.getOption("textwidth");var n=Math.round(e);n>1&&t.setOption("textwidth",n)}});var A=function(){var e=-1,t=0,n=0,r=Array(100);function i(i,o){(e+=o)>t?e=t:e<n&&(e=n);var a=r[(100+e)%100];if(a&&!a.find()){var s,l=o>0?1:-1,c=i.getCursor();do if(e+=l,(a=r[(100+e)%100])&&(s=a.find())&&!ei(c,s))break;while(e<t&&e>n)}return a}return{cachedCursor:void 0,add:function(i,o,a){var s=r[e%100];function l(t){var n=++e%100,o=r[n];o&&o.clear(),r[n]=i.setBookmark(t)}if(s){var c=s.find();c&&!ei(c,o)&&l(o)}else l(o);l(a),t=e,(n=e-100+1)<0&&(n=0)},find:function(t,n){var r=e,o=i(t,n);return e=r,o&&o.find()},move:i}},O=function(e){return e?{changes:e.changes,expectCursorActivityForChange:e.expectCursorActivityForChange}:{changes:[],expectCursorActivityForChange:!1}};class E{constructor(){this.latestRegister=void 0,this.isPlaying=!1,this.isRecording=!1,this.replaySearchQueries=[],this.onRecordingDone=void 0,this.lastInsertModeChanges=O()}exitMacroRecordMode(){var e=n.macroModeState;e.onRecordingDone&&e.onRecordingDone(),e.onRecordingDone=void 0,e.isRecording=!1}enterMacroRecordMode(e,t){var r=n.registerController.getRegister(t);if(r){if(r.clear(),this.latestRegister=t,e.openDialog){var i=eP("span",{class:"cm-vim-message"},"recording @"+t);this.onRecordingDone=e.openDialog(i,null,{bottom:!0})}this.isRecording=!0}}}function T(e){return e.state.vim||(e.state.vim={inputState:new V,lastEditInputState:void 0,lastEditActionCommand:void 0,lastHPos:-1,lastHSPos:-1,lastMotion:null,marks:{},insertMode:!1,insertModeReturn:!1,insertModeRepeat:void 0,visualMode:!1,visualLine:!1,visualBlock:!1,lastSelection:null,lastPastedText:null,sel:{},options:{},expectLiteralNext:!1}),e.state.vim}function R(){for(var e in n={searchQuery:null,searchIsReversed:!1,lastSubstituteReplacePart:void 0,jumpList:A(),macroModeState:new E,lastCharacterSearch:{increment:0,forward:!0,selectedCharacter:""},registerController:new q({}),searchHistoryController:new Q,exCommandHistoryController:new Q},S){var t=S[e];t.value=t.defaultValue}}var B={enterVimMode:function(t){t.setOption("disableInput",!0),t.setOption("showCursorWhenSelecting",!1),e.signal(t,"vim-mode-change",{mode:"normal"}),t.on("cursorActivity",eY),T(t),e.on(t.getInputField(),"paste",h(t))},leaveVimMode:function(t){t.setOption("disableInput",!1),t.off("cursorActivity",eY),e.off(t.getInputField(),"paste",h(t)),t.state.vim=null,e_&&clearTimeout(e_)},buildKeyMap:function(){},getRegisterController:function(){return n.registerController},resetVimGlobalState_:R,getVimGlobalState_:function(){return n},maybeInitVimState_:T,suppressErrorLogging:!1,InsertModeKey:e1,map:function(e,t,n){ez.map(e,t,n)},unmap:function(e,t){return ez.unmap(e,t)},noremap:function(e,t,n){ez.map(e,t,n,!0)},mapclear:function(e){var t=s.length,n=s.slice(0,t-l);if(s=s.slice(t-l),e)for(var r=n.length-1;r>=0;r--){var i=n[r];if(e!==i.context){if(i.context)this._mapCommand(i);else{var o=["normal","insert","visual"];for(var a in o)if(o[a]!==e){var c=Object.assign({},i);c.context=o[a],this._mapCommand(c)}}}}},langmap:_,vimKeyFromEvent:H,setOption:L,getOption:b,defineOption:M,defineEx:function(e,t,n){if(t){if(0!==e.indexOf(t))throw Error('(Vim.defineEx) "'+t+'" is not a prefix of "'+e+'", command not registered')}else t=e;eJ[e]=n,ez.commandMap_[t]={name:e,shortName:t,type:"api"}},handleKey:function(e,t,n){var r=this.findKey(e,t,n);if("function"==typeof r)return r()},multiSelectHandleKey:function(e,t,n){var r=T(e),i=!1,r=B.maybeInitVimState_(e),o=r.visualBlock||r.wasInVisualBlock,a=e.isInMultiSelectMode();if(r.wasInVisualBlock&&!a?r.wasInVisualBlock=!1:a&&r.visualBlock&&(r.wasInVisualBlock=!0),"<Esc>"!=t||r.insertMode||r.visualMode||!a||"<Esc>"!=r.status){if(o||!a||e.inVirtualSelectionMode)i=B.handleKey(e,t,n);else{var s=e8(r),l=r.inputState.changeQueueList||[];e.operation(function(){e.curOp&&(e.curOp.isVimOp=!0);var o=0;e.forEachSelection(function(){e.state.vim.inputState.changeQueue=l[o];var r=e.getCursor("head"),a=e.getCursor("anchor"),c=eo(r,a)?0:-1,u=eo(r,a)?-1:0;r=et(r,0,c),a=et(a,0,u),e.state.vim.sel.head=r,e.state.vim.sel.anchor=a,i=B.handleKey(e,t,n),e.virtualSelection&&(l[o]=e.state.vim.inputState.changeQueue,e.state.vim=e8(s)),o++}),e.curOp?.cursorActivity&&!i&&(e.curOp.cursorActivity=!1),e.state.vim=r,r.inputState.changeQueueList=l,r.inputState.changeQueue=null},!0)}}else W(e);return!i||r.visualMode||r.insert||r.visualMode==e.somethingSelected()||e0(e,r),i},findKey:function(e,t,i){var o,a=T(e);function l(){if("<Esc>"==t){if(a.visualMode)eg(e);else{if(!a.insertMode)return;eZ(e)}return W(e),!0}}return!1===(o=a.insertMode?function(){if(l())return!0;a.inputState.keyBuffer.push(t);var i=a.inputState.keyBuffer.join(""),o=1==t.length,c=J.matchCommand(i,s,a.inputState,"insert"),u=a.inputState.changeQueue;if("none"==c.type)return W(e),!1;if("partial"==c.type){if(c.expectLiteralNext&&(a.expectLiteralNext=!0),r&&window.clearTimeout(r),r=o&&window.setTimeout(function(){a.insertMode&&a.inputState.keyBuffer.length&&W(e)},b("insertModeEscKeysTimeout")),o){var h=e.listSelections();u&&u.removed.length==h.length||(u=a.inputState.changeQueue=new $),u.inserted+=t;for(var d=0;d<h.length;d++){var m=ea(h[d].anchor,h[d].head),p=es(h[d].anchor,h[d].head),f=e.getRange(m,e.state.overwrite?et(p,0,1):p);u.removed[d]=(u.removed[d]||"")+f}}return!o}if(a.expectLiteralNext=!1,r&&window.clearTimeout(r),c.command&&u){for(var h=e.listSelections(),d=0;d<h.length;d++){var g=h[d].head;e.replaceRange(u.removed[d]||"",et(g,0,-u.inserted.length),g,"+input")}n.macroModeState.lastInsertModeChanges.changes.pop()}return c.command||W(e),c.command}():function(){if(function(){var r=n.macroModeState;if(r.isRecording){if("q"==t)return r.exitMacroRecordMode(),W(e),!0;"mapping"!=i&&function(e,t){if(!e.isPlaying){var r=e.latestRegister,i=n.registerController.getRegister(r);i&&i.pushText(t)}}(r,t)}}()||l())return!0;a.inputState.keyBuffer.push(t);var r=a.inputState.keyBuffer.join("");if(/^[1-9]\d*$/.test(r))return!0;var o=/^(\d*)(.*)$/.exec(r);if(!o)return W(e),!1;var c=a.visualMode?"visual":"normal",u=o[2]||o[1];a.inputState.operatorShortcut&&a.inputState.operatorShortcut.slice(-1)==u&&(u=a.inputState.operatorShortcut);var h=J.matchCommand(u,s,a.inputState,c);return"none"==h.type?(W(e),!1):"partial"==h.type?(h.expectLiteralNext&&(a.expectLiteralNext=!0),!0):"clear"==h.type?(W(e),!0):(a.expectLiteralNext=!1,a.inputState.keyBuffer.length=0,(o=/^(\d*)(.*)$/.exec(r))&&o[1]&&"0"!=o[1]&&a.inputState.pushRepeatDigit(o[1]),h.command)}())?a.insertMode||1!==t.length?void 0:function(){return!0}:!0===o?function(){return!0}:function(){return e.operation(function(){e.curOp.isVimOp=!0;try{"keyToKey"==o.type?K(e,o.toKeys,o):J.processCommand(e,a,o)}catch(t){throw e.state.vim=void 0,T(e),B.suppressErrorLogging||console.log(t),t}return!0})}},handleEx:function(e,t){ez.processCommand(e,t)},defineMotion:function(e,t){z[e]=t},defineAction:function(e,t){G[e]=t},defineOperator:function(e,t){X[e]=t},mapCommand:function(e,t,n,r,i){var o={keys:e,type:t};for(var a in o[t]=n,o[t+"Args"]=r,i)o[a]=i[a];eX(o)},_mapCommand:eX,defineRegister:function(e,t){var r=n.registerController.registers;if(!e||1!=e.length)throw Error("Register name must be 1 character");if(r[e])throw Error("Register already defined "+e);r[e]=t,g.push(e)},exitVisualMode:eg,exitInsertMode:eZ},N=[],I=!1;function K(e,t,n){var r=I;if(n){if(-1!=N.indexOf(n))return;N.push(n),I=!1!=n.noremap}try{for(var o,a=T(e),s=/<(?:[CSMA]-)*\w+>|./gi;o=s.exec(t);){var l=o[0],c=a.insertMode;if(i){!function(e){if("<"==e[0]){var t=e.toLowerCase().slice(1,-1);if("lt"==(t=t.split("-").pop()||""))e="<";else if("space"==t)e=" ";else if("cr"==t)e="\n";else if(F[t]){var n=i.value,r={key:F[t],target:{value:n,selectionEnd:n.length,selectionStart:n.length}};i.onKeyDown&&i.onKeyDown(r,i.value,a),i&&i.onKeyUp&&i.onKeyUp(r,i.value,a);return}}if("\n"==e){var o=i;i=null,o.onClose&&o.onClose(o.value)}else i.value=(i.value||"")+e;function a(e){"string"==typeof e?i.value=e:i=null}}(l);continue}if(!B.handleKey(e,l,"mapping")&&c&&a.insertMode){if("<"==l[0]){var u=l.toLowerCase().slice(1,-1);if(u=u.split("-").pop()||"","lt"==u)l="<";else if("space"==u)l=" ";else if("cr"==u)l="\n";else if(F.hasOwnProperty(u)){l=F[u],e5(e,l);continue}else l=l[0],s.lastIndex=o.index+1}e.replaceSelection(l)}}}finally{if(N.pop(),I=!!N.length&&r,!N.length&&i){var h=i;i=null,eF(e,h)}}}var P={Return:"CR",Backspace:"BS",Delete:"Del",Escape:"Esc",Insert:"Ins",ArrowLeft:"Left",ArrowRight:"Right",ArrowUp:"Up",ArrowDown:"Down",Enter:"CR"," ":"Space"},D={Shift:1,Alt:1,Command:1,Control:1,CapsLock:1,AltGraph:1,Dead:1,Unidentified:1},F={};function H(t,n){var r=t.key;if(!D[r]){r.length>1&&"n"==r[0]&&(r=r.replace("Numpad","")),r=P[r]||r;var i="";if(t.ctrlKey&&(i+="C-"),t.altKey&&(i+="A-"),t.metaKey&&(i+="M-"),e.isMac&&t.altKey&&!t.metaKey&&!t.ctrlKey&&(i=i.slice(2)),(i||r.length>1)&&t.shiftKey&&(i+="S-"),n&&!n.expectLiteralNext&&1==r.length){if(u.keymap&&r in u.keymap)!1==u.remapCtrl&&i||(r=u.keymap[r]);else if(r.charCodeAt(0)>255){var o=t.code?.slice(-1)||"";t.shiftKey||(o=o.toLowerCase()),o&&(r=o)}}return(i+=r).length>1&&(i="<"+i+">"),i}}function _(e,t){u.string!==e&&(u=j(e)),u.remapCtrl=t}function j(e){let t={};if(!e)return{keymap:t,string:""};function n(e){return e.split(/\\?(.)/).filter(Boolean)}return e.split(/((?:[^\\,]|\\.)+),/).map(e=>{if(!e)return;let r=e.split(/((?:[^\\;]|\\.)+);/);if(3==r.length){let e=n(r[1]),i=n(r[2]);if(e.length!==i.length)return;for(let n=0;n<e.length;++n)t[e[n]]=i[n]}else if(1==r.length){let r=n(e);if(r.length%2!=0)return;for(let e=0;e<r.length;e+=2)t[r[e]]=r[e+1]}}),{keymap:t,string:e}}"Left|Right|Up|Down|End|Home".split("|").concat(Object.keys(P)).forEach(function(e){F[(P[e]||"").toLowerCase()]=F[e.toLowerCase()]=e}),M("langmap",void 0,"string",["lmap"],function(e,t){if(void 0===e)return u.string;_(e)});class V{constructor(){this.prefixRepeat=[],this.motionRepeat=[],this.operator=null,this.operatorArgs=null,this.motion=null,this.motionArgs=null,this.keyBuffer=[],this.registerName=null,this.changeQueue=null}pushRepeatDigit(e){this.operator?this.motionRepeat=this.motionRepeat.concat(e):this.prefixRepeat=this.prefixRepeat.concat(e)}getRepeat(){var e=0;return(this.prefixRepeat.length>0||this.motionRepeat.length>0)&&(e=1,this.prefixRepeat.length>0&&(e*=parseInt(this.prefixRepeat.join(""),10)),this.motionRepeat.length>0&&(e*=parseInt(this.motionRepeat.join(""),10))),e}}function W(t,n){t.state.vim.inputState=new V,t.state.vim.expectLiteralNext=!1,e.signal(t,"vim-command-done",n)}function $(){this.removed=[],this.inserted=""}class U{constructor(e,t,n){this.clear(),this.keyBuffer=[e||""],this.insertModeChanges=[],this.searchQueries=[],this.linewise=!!t,this.blockwise=!!n}setText(e,t,n){this.keyBuffer=[e||""],this.linewise=!!t,this.blockwise=!!n}pushText(e,t){t&&(this.linewise||this.keyBuffer.push("\n"),this.linewise=!0),this.keyBuffer.push(e)}pushInsertModeChanges(e){this.insertModeChanges.push(O(e))}pushSearchQuery(e){this.searchQueries.push(e)}clear(){this.keyBuffer=[],this.insertModeChanges=[],this.searchQueries=[],this.linewise=!1}toString(){return this.keyBuffer.join("")}}class q{constructor(e){this.registers=e,this.unnamedRegister=e['"']=new U,e["."]=new U,e[":"]=new U,e["/"]=new U,e["+"]=new U}pushText(e,n,r,i,o){if("_"!==e){i&&"\n"!==r.charAt(r.length-1)&&(r+="\n");var a=this.isValidRegister(e)?this.getRegister(e):null;if(!a){switch(n){case"yank":this.registers["0"]=new U(r,i,o);break;case"delete":case"change":-1==r.indexOf("\n")?this.registers["-"]=new U(r,i):(this.shiftNumericRegisters_(),this.registers["1"]=new U(r,i))}this.unnamedRegister.setText(r,i,o);return}t.test(e)?a.pushText(r,i):a.setText(r,i,o),"+"===e&&navigator.clipboard.writeText(r),this.unnamedRegister.setText(a.toString(),i)}}getRegister(e){return this.isValidRegister(e)?(e=e.toLowerCase(),this.registers[e]||(this.registers[e]=new U),this.registers[e]):this.unnamedRegister}isValidRegister(e){return e&&(x(e,g)||v.test(e))}shiftNumericRegisters_(){for(var e=9;e>=2;e--)this.registers[e]=this.getRegister(""+(e-1))}}class Q{constructor(){this.historyBuffer=[],this.iterator=0,this.initialPrefix=null}nextMatch(e,t){var n=this.historyBuffer,r=t?-1:1;null===this.initialPrefix&&(this.initialPrefix=e);for(var i=this.iterator+r;t?i>=0:i<n.length;i+=r)for(var o=n[i],a=0;a<=o.length;a++)if(this.initialPrefix==o.substring(0,a))return this.iterator=i,o;return i>=n.length?(this.iterator=n.length,this.initialPrefix):i<0?e:void 0}pushInput(e){var t=this.historyBuffer.indexOf(e);t>-1&&this.historyBuffer.splice(t,1),e.length&&this.historyBuffer.push(e)}reset(){this.initialPrefix=null,this.iterator=this.historyBuffer.length}}var J={matchCommand:function(e,t,n,r){var i,o=function(e,t,n,r){r.operator&&(n="operatorPending");for(var i,o=[],a=[],s=I?t.length-l:0,c=s;c<t.length;c++){var u=t[c];("insert"!=n||"insert"==u.context)&&(!u.context||u.context==n)&&(!r.operator||"action"!=u.type)&&(i=function(e,t){let n="<character>"==t.slice(-11),r="<register>"==t.slice(-10);if(!n&&!r)return e==t?"full":0==t.indexOf(e)&&"partial";var i=t.length-(n?11:10),o=e.slice(0,i),a=t.slice(0,i);return o==a&&e.length>i?"full":0==a.indexOf(o)&&"partial"}(e,u.keys))&&("partial"==i&&o.push(u),"full"==i&&a.push(u))}return{partial:o.length&&o,full:a.length&&a}}(e,t,r,n);if(!o.full&&!o.partial)return{type:"none"};if(!o.full&&o.partial)return{type:"partial",expectLiteralNext:1==o.partial.length&&"<character>"==o.partial[0].keys.slice(-11)};for(var a=0;a<o.full.length;a++){var s=o.full[a];i||(i=s)}if("<character>"==i.keys.slice(-11)||"<register>"==i.keys.slice(-10)){var c=function(e){var t=/^.*(<[^>]+>)$/.exec(e),n=t?t[1]:e.slice(-1);if(n.length>1)switch(n){case"<CR>":case"<S-CR>":n="\n";break;case"<Space>":case"<S-Space>":n=" ";break;default:n=""}return n}(e);if(!c||c.length>1)return{type:"clear"};n.selectedCharacter=c}return{type:"full",command:i}},processCommand:function(e,t,n){switch(t.inputState.repeatOverride=n.repeatOverride,n.type){case"motion":this.processMotion(e,t,n);break;case"operator":this.processOperator(e,t,n);break;case"operatorMotion":this.processOperatorMotion(e,t,n);break;case"action":this.processAction(e,t,n);break;case"search":this.processSearch(e,t,n);break;case"ex":case"keyToEx":this.processEx(e,t,n)}},processMotion:function(e,t,n){t.inputState.motion=n.motion,t.inputState.motionArgs=ee(n.motionArgs),this.evalInput(e,t)},processOperator:function(e,t,n){var r=t.inputState;if(r.operator){if(r.operator==n.operator){r.motion="expandToLine",r.motionArgs={linewise:!0,repeat:1},this.evalInput(e,t);return}W(e)}r.operator=n.operator,r.operatorArgs=ee(n.operatorArgs),n.keys.length>1&&(r.operatorShortcut=n.keys),n.exitVisualBlock&&(t.visualBlock=!1,ep(e)),t.visualMode&&this.evalInput(e,t)},processOperatorMotion:function(e,t,n){var r=t.visualMode,i=ee(n.operatorMotionArgs);i&&r&&i.visualLine&&(t.visualLine=!0),this.processOperator(e,t,n),r||this.processMotion(e,t,n)},processAction:function(e,t,n){var r=t.inputState,i=r.getRepeat(),o=!!i,a=ee(n.actionArgs)||{repeat:1};r.selectedCharacter&&(a.selectedCharacter=r.selectedCharacter),n.operator&&this.processOperator(e,t,n),n.motion&&this.processMotion(e,t,n),(n.motion||n.operator)&&this.evalInput(e,t),a.repeat=i||1,a.repeatIsExplicit=o,a.registerName=r.registerName,W(e),t.lastMotion=null,n.isEdit&&this.recordLastEdit(t,r,n),G[n.action](e,a,t)},processSearch:function(t,r,i){if(t.getSearchCursor){var o=i.searchArgs.forward,a=i.searchArgs.wholeWordOnly;eR(t).setReversed(!o);var s=eR(t).getQuery(),l=t.getScrollInfo();switch(i.searchArgs.querySrc){case"prompt":var c=n.macroModeState;c.isPlaying?d(c.replaySearchQueries.shift(),!0,!1):eF(t,{onClose:function(e){t.scrollTo(l.left,l.top),d(e,!0,!0);var r=n.macroModeState;r.isRecording&&function(e,t){if(!e.isPlaying){var r=e.latestRegister,i=n.registerController.getRegister(r);i&&i.pushSearchQuery&&i.pushSearchQuery(t)}}(r,e)},prefix:o?"/":"?",desc:"(JavaScript regexp)",onKeyUp:function(e,r,i){var a,s,c,u=H(e);"<Up>"==u||"<Down>"==u?(s="<Up>"==u,c=e.target?e.target.selectionEnd:0,i(r=n.searchHistoryController.nextMatch(r,s)||""),c&&e.target&&(e.target.selectionEnd=e.target.selectionStart=Math.min(c,e.target.value.length))):u&&"<Left>"!=u&&"<Right>"!=u&&n.searchHistoryController.reset();try{a=eH(t,r,!0,!0)}catch(e){}a?t.scrollIntoView(eV(t,!o,a),30):(eW(t),t.scrollTo(l.left,l.top))},onKeyDown:function(r,i,o){var a=H(r);"<Esc>"==a||"<C-c>"==a||"<C-[>"==a||"<BS>"==a&&""==i?(n.searchHistoryController.pushInput(i),n.searchHistoryController.reset(),eH(t,s),eW(t),t.scrollTo(l.left,l.top),e.e_stop(r),W(t),o(),t.focus()):"<Up>"==a||"<Down>"==a?e.e_stop(r):"<C-u>"==a&&(e.e_stop(r),o(""))}});break;case"wordUnderCursor":var u=ey(t,{noSymbol:!0}),h=!0;if(u||(u=ey(t,{noSymbol:!1}),h=!1),!u){eD(t,"No word under cursor"),W(t);return}let r=t.getLine(u.start.line).substring(u.start.ch,u.end.ch);r=h&&a?"\\b"+r+"\\b":r.replace(/([.?*+$\[\]\/\\(){}|\-])/g,"\\$1"),n.jumpList.cachedCursor=t.getCursor(),t.setCursor(u.start),d(r,!0,!1)}}function d(e,o,a){n.searchHistoryController.pushInput(e),n.searchHistoryController.reset();try{eH(t,e,o,a)}catch(n){eD(t,"Invalid regex: "+e),W(t);return}J.processMotion(t,r,{keys:"",type:"motion",motion:"findNext",motionArgs:{forward:!0,toJumplist:i.searchArgs.toJumplist}})}},processEx:function(t,r,i){function o(e){n.exCommandHistoryController.pushInput(e),n.exCommandHistoryController.reset(),ez.processCommand(t,e),t.state.vim&&W(t)}function a(r,i,o){var a,s,l=H(r);("<Esc>"==l||"<C-c>"==l||"<C-[>"==l||"<BS>"==l&&""==i)&&(n.exCommandHistoryController.pushInput(i),n.exCommandHistoryController.reset(),e.e_stop(r),W(t),o(),t.focus()),"<Up>"==l||"<Down>"==l?(e.e_stop(r),a="<Up>"==l,s=r.target?r.target.selectionEnd:0,o(i=n.exCommandHistoryController.nextMatch(i,a)||""),s&&r.target&&(r.target.selectionEnd=r.target.selectionStart=Math.min(s,r.target.value.length))):"<C-u>"==l?(e.e_stop(r),o("")):l&&"<Left>"!=l&&"<Right>"!=l&&n.exCommandHistoryController.reset()}"keyToEx"==i.type?ez.processCommand(t,i.exArgs.input):r.visualMode?eF(t,{onClose:o,prefix:":",value:"'<,'>",onKeyDown:a,selectValueOnOpen:!1}):eF(t,{onClose:o,prefix:":",onKeyDown:a})},evalInput:function(e,t){var r=t.inputState,i=r.motion,s=r.motionArgs||{repeat:1},l=r.operator,c=r.operatorArgs||{},u=r.registerName,h=t.sel,d=er(t.visualMode?Y(e,h.head):e.getCursor("head")),m=er(t.visualMode?Y(e,h.anchor):e.getCursor("anchor")),p=er(d),f=er(m);if(l&&this.recordLastEdit(t,r),(x=void 0!==r.repeatOverride?r.repeatOverride:r.getRepeat())>0&&s.explicitRepeat?s.repeatIsExplicit=!0:(s.noRepeat||!s.explicitRepeat&&0===x)&&(x=1,s.repeatIsExplicit=!1),r.selectedCharacter&&(s.selectedCharacter=c.selectedCharacter=r.selectedCharacter),s.repeat=x,W(e),i){var g=z[i](e,d,s,t,r);if(t.lastMotion=z[i],!g)return;if(s.toJumplist){var v=n.jumpList,y=v.cachedCursor;y?(eC(e,y,g),delete v.cachedCursor):eC(e,d,g)}g instanceof Array?(w=g[0],C=g[1]):C=g,C||(C=er(d)),t.visualMode?(t.visualBlock&&C.ch===1/0||(C=Y(e,C,p)),w&&(w=Y(e,w)),w=w||f,h.anchor=w,h.head=C,ep(e),eb(e,t,"<",eo(w,C)?w:C),eb(e,t,">",eo(w,C)?C:w)):l||(C=Y(e,C,p),e.setCursor(C.line,C.ch))}if(l){if(c.lastSel){w=f;var C,w,x,S,M,L,b,A,O=c.lastSel,E=Math.abs(O.head.line-O.anchor.line),T=Math.abs(O.head.ch-O.anchor.ch);C=O.visualLine?new o(f.line+E,f.ch):O.visualBlock?new o(f.line+E,f.ch+T):O.head.line==O.anchor.line?new o(f.line,f.ch+T):new o(f.line+E,f.ch),t.visualMode=!0,t.visualLine=O.visualLine,t.visualBlock=O.visualBlock,h=t.sel={anchor:w,head:C},ep(e)}else t.visualMode&&(c.lastSel={anchor:er(h.anchor),head:er(h.head),visualBlock:t.visualBlock,visualLine:t.visualLine});if(t.visualMode){S=ea(h.head,h.anchor),M=es(h.head,h.anchor),L=t.visualLine||c.linewise,b=t.visualBlock?"block":L?"line":"char";var R=a(e,S,M);if(A=ef(e,{anchor:R.start,head:R.end},b),L){var B=A.ranges;if("block"==b)for(var N=0;N<B.length;N++)B[N].head.ch=ec(e,B[N].head.line);else"line"==b&&(B[0].head=new o(B[0].head.line+1,0))}}else{if(S=er(w||f),eo(M=er(C||p),S)){var I,K,P=S;S=M,M=P}(L=s.linewise||c.linewise)?(I=S,K=M,I.ch=0,K.ch=0,K.line++):s.forward&&function(e,t,n){var r=e.getRange(t,n);if(/\n\s*$/.test(r)){var i=r.split("\n");i.pop();for(var o=i.pop();i.length>0&&o&&k(o);o=i.pop())n.line--,n.ch=0;o?(n.line--,n.ch=ec(e,n.line)):n.ch=0}}(e,S,M),b="char";var D=!s.inclusive||L,R=a(e,S,M);A=ef(e,{anchor:R.start,head:R.end},b,D)}e.setSelections(A.ranges,A.primary),t.lastMotion=null,c.repeat=x,c.registerName=u,c.linewise=L;var F=X[l](e,c,A.ranges,f,C);t.visualMode&&eg(e,null!=F),F&&e.setCursor(F)}},recordLastEdit:function(e,t,r){var i=n.macroModeState;i.isPlaying||(e.lastEditInputState=t,e.lastEditActionCommand=r,i.lastInsertModeChanges.changes=[],i.lastInsertModeChanges.expectCursorActivityForChange=!1,i.lastInsertModeChanges.visualBlock=e.visualBlock?e.sel.head.line-e.sel.anchor.line:0)}},z={moveToTopLine:function(e,t,n){var r=e$(e).top+n.repeat-1;return new o(r,ev(e.getLine(r)))},moveToMiddleLine:function(e){var t=e$(e),n=Math.floor((t.top+t.bottom)*.5);return new o(n,ev(e.getLine(n)))},moveToBottomLine:function(e,t,n){var r=e$(e).bottom-n.repeat+1;return new o(r,ev(e.getLine(r)))},expandToLine:function(e,t,n){return new o(t.line+n.repeat-1,1/0)},findNext:function(e,t,n){var r=eR(e),i=r.getQuery();if(i){var o=!n.forward;return o=r.isReversed()?!o:o,ej(e,i),eV(e,o,i,n.repeat)}},findAndSelectNextInclusive:function(t,n,r,i,a){var s,l,c=eR(t),u=c.getQuery();if(u){var h=!r.forward,d=(s=h=c.isReversed()?!h:h,l=r.repeat,t.operation(function(){void 0===l&&(l=1);var e=t.getCursor(),n=t.getSearchCursor(u,e),r=n.find(!s);!i.visualMode&&r&&ei(n.from(),e)&&n.find(!s);for(var a=0;a<l;a++)if(!(r=n.find(s))&&!(n=t.getSearchCursor(u,s?new o(t.lastLine()):new o(t.firstLine(),0))).find(s))return;return[n.from(),n.to()]}));if(d){if(a.operator)return d;var m=d[0],p=new o(d[1].line,d[1].ch-1);if(i.visualMode){(i.visualLine||i.visualBlock)&&(i.visualLine=!1,i.visualBlock=!1,e.signal(t,"vim-mode-change",{mode:"visual",subMode:""}));var f=i.sel.anchor;if(f)return c.isReversed()?r.forward?[f,m]:[f,p]:r.forward?[f,p]:[f,m]}else i.visualMode=!0,i.visualLine=!1,i.visualBlock=!1,e.signal(t,"vim-mode-change",{mode:"visual",subMode:""});return h?[p,m]:[m,p]}}},goToMark:function(e,t,n,r){var i=eU(e,r,n.selectedCharacter||"");return i?n.linewise?{line:i.line,ch:ev(e.getLine(i.line))}:i:null},moveToOtherHighlightedEnd:function(e,t,n,r){if(!r.visualBlock||!n.sameLine)return[r.sel.head,r.sel.anchor];var i=r.sel;return[Y(e,new o(i.anchor.line,i.head.ch)),Y(e,new o(i.head.line,i.anchor.ch))]},jumpToMark:function(e,t,n,r){for(var i=t,a=0;a<n.repeat;a++){var s=i;for(var l in r.marks)if(C(l)){var c=r.marks[l].find();if((n.forward?!eo(c,s):!eo(s,c))&&(!n.linewise||c.line!=s.line)){var u=ei(s,i),h=n.forward?el(s,c,i):el(i,c,s);(u||h)&&(i=c)}}}return n.linewise&&(i=new o(i.line,ev(e.getLine(i.line)))),i},moveByCharacters:function(e,t,n){var r=n.repeat,i=n.forward?t.ch+r:t.ch-r;return new o(t.line,i)},moveByLines:function(e,t,n,r){var i=t.ch;switch(r.lastMotion){case this.moveByLines:case this.moveByDisplayLines:case this.moveByScroll:case this.moveToColumn:case this.moveToEol:i=r.lastHPos;break;default:r.lastHPos=i}var a=n.repeat+(n.repeatOffset||0),s=n.forward?t.line+a:t.line-a,l=e.firstLine(),c=e.lastLine(),u=e.findPosV(t,n.forward?a:-a,"line",r.lastHSPos);return((n.forward?u.line>s:u.line<s)&&(s=u.line,i=u.ch),s<l&&t.line==l)?this.moveToStartOfLine(e,t,n,r):s>c&&t.line==c?eM(e,t,n,r,!0):(n.toFirstChar&&(i=ev(e.getLine(s)),r.lastHPos=i),r.lastHSPos=e.charCoords(new o(s,i),"div").left,new o(s,i))},moveByDisplayLines:function(e,t,n,r){switch(r.lastMotion){case this.moveByDisplayLines:case this.moveByScroll:case this.moveByLines:case this.moveToColumn:case this.moveToEol:break;default:r.lastHSPos=e.charCoords(t,"div").left}var i=n.repeat,a=e.findPosV(t,n.forward?i:-i,"line",r.lastHSPos);if(a.hitSide){if(n.forward){var s={top:e.charCoords(a,"div").top+8,left:r.lastHSPos};a=e.coordsChar(s,"div")}else{var l=e.charCoords(new o(e.firstLine(),0),"div");l.left=r.lastHSPos,a=e.coordsChar(l,"div")}}return r.lastHPos=a.ch,a},moveByPage:function(e,t,n){var r=n.repeat;return e.findPosV(t,n.forward?r:-r,"page")},moveByParagraph:function(e,t,n){var r=n.forward?1:-1;return eA(e,t,n.repeat,r).start},moveBySentence:function(e,t,n){var r=n.forward?1:-1;return function(e,t,n,r){function i(e,t){if(t.pos+t.dir<0||t.pos+t.dir>=t.line.length){if(t.ln+=t.dir,!y(e,t.ln)){t.line=null,t.ln=null,t.pos=null;return}t.line=e.getLine(t.ln),t.pos=t.dir>0?0:t.line.length-1}else t.pos+=t.dir}for(var a={ln:t.line,pos:t.ch};n>0;)a=r<0?function(e,t,n,r){var o=e.getLine(t),a={line:o,ln:t,pos:n,dir:r},s={ln:a.ln,pos:null},l=""===a.line;for(i(e,a);null!==a.line;){if(""!==a.line||l){if(w(a.line[a.pos])&&null!==s.pos&&!(a.ln===s.ln&&a.pos+1===s.pos))return s;""===a.line||k(a.line[a.pos])||(l=!1,s={ln:a.ln,pos:a.pos})}else{if(null!==s.pos)return s;return{ln:a.ln,pos:a.pos}}i(e,a)}var o=e.getLine(s.ln);s.pos=0;for(var c=0;c<o.length;++c)if(!k(o[c])){s.pos=c;break}return s}(e,a.ln,a.pos,r):function(e,t,n,r){var o=e.getLine(t),a=""===o,s={line:o,ln:t,pos:n,dir:r},l={ln:s.ln,pos:s.pos},c=""===s.line;for(i(e,s);null!==s.line;){if(l.ln=s.ln,l.pos=s.pos,""===s.line&&!c||a&&""!==s.line&&!k(s.line[s.pos]))return{ln:s.ln,pos:s.pos};w(s.line[s.pos])&&!a&&(s.pos===s.line.length-1||k(s.line[s.pos+1]))&&(a=!0),i(e,s)}var o=e.getLine(l.ln);l.pos=0;for(var u=o.length-1;u>=0;--u)if(!k(o[u])){l.pos=u;break}return l}(e,a.ln,a.pos,r),n--;return new o(a.ln,a.pos)}(e,t,n.repeat,r)},moveByScroll:function(e,t,n,r){var i=e.getScrollInfo(),o=null,a=n.repeat;a||(a=i.clientHeight/(2*e.defaultTextHeight()));var s=e.charCoords(t,"local");if(n.repeat=a,!(o=z.moveByDisplayLines(e,t,n,r)))return null;var l=e.charCoords(o,"local");return e.scrollTo(null,i.top+l.top-s.top),o},moveByWords:function(e,t,n){return function(e,t,n,r,i,a){var s=er(t),l=[];(r&&!i||!r&&i)&&n++;for(var c=!(r&&i),u=0;u<n;u++){var h=eS(e,t,r,a,c);if(!h){var d=ec(e,e.lastLine());l.push(r?{line:e.lastLine(),from:d,to:d}:{line:0,from:0,to:0});break}l.push(h),t=new o(h.line,r?h.to-1:h.from)}var m=l.length!=n,p=l[0],f=l.pop();return r&&!i?(m||p.from==s.ch&&p.line==s.line||(f=l.pop()),f&&new o(f.line,f.from)):r&&i?f&&new o(f.line,f.to-1):!r&&i?(m||p.to==s.ch&&p.line==s.line||(f=l.pop()),f&&new o(f.line,f.to)):f&&new o(f.line,f.from)}(e,t,n.repeat,!!n.forward,!!n.wordEnd,!!n.bigWord)},moveTillCharacter:function(e,t,n){var r=eL(e,n.repeat,n.forward,n.selectedCharacter,t),i=n.forward?-1:1;return(ek(i,n),r)?(r.ch+=i,r):null},moveToCharacter:function(e,t,n){var r=n.repeat;return ek(0,n),eL(e,r,n.forward,n.selectedCharacter,t)||t},moveToSymbol:function(e,t,n){var r=n.repeat;return n.selectedCharacter&&function(e,t,n,r){var i=er(e.getCursor()),a=n?1:-1,s=n?e.lineCount():-1,l=i.ch,c=i.line,u=e.getLine(c),h={lineText:u,nextCh:u.charAt(l),lastCh:null,index:l,symb:r,reverseSymb:(n?{")":"(","}":"{"}:{"(":")","{":"}"})[r],forward:n,depth:0,curMoveThrough:!1},d=ew[r];if(!d)return i;var m=ex[d].init,p=ex[d].isComplete;for(m&&m(h);c!==s&&t;){if(h.index+=a,h.nextCh=h.lineText.charAt(h.index),!h.nextCh){if(c+=a,h.lineText=e.getLine(c)||"",a>0)h.index=0;else{var f=h.lineText.length;h.index=f>0?f-1:0}h.nextCh=h.lineText.charAt(h.index)}p(h)&&(i.line=c,i.ch=h.index,t--)}return h.nextCh||h.curMoveThrough?new o(c,h.index):i}(e,r,n.forward,n.selectedCharacter)||t},moveToColumn:function(e,t,n,r){var i,a=n.repeat;return r.lastHPos=a-1,r.lastHSPos=e.charCoords(t,"div").left,i=e.getCursor().line,Y(e,new o(i,a-1))},moveToEol:function(e,t,n,r){return eM(e,t,n,r,!1)},moveToFirstNonWhiteSpaceCharacter:function(e,t){return new o(t.line,ev(e.getLine(t.line)))},moveToMatchedSymbol:function(e,t){for(var n,r,i=t.line,a=t.ch,s=e.getLine(i);a<s.length;a++)if((n=s.charAt(a))&&(r=n,-1!="()[]{}".indexOf(r))){var l=e.getTokenTypeAt(new o(i,a+1));if("string"!==l&&"comment"!==l)break}if(!(a<s.length))return t;var c="<"===n||">"===n?/[(){}[\]<>]/:/[(){}[\]]/;return e.findMatchingBracket(new o(i,a),{bracketRegex:c}).to},moveToStartOfLine:function(e,t){return new o(t.line,0)},moveToLineOrEdgeOfDocument:function(e,t,n){var r=n.forward?e.lastLine():e.firstLine();return n.repeatIsExplicit&&(r=n.repeat-e.getOption("firstLineNumber")),new o(r,ev(e.getLine(r)))},moveToStartOfDisplayLine:function(e){return e.execCommand("goLineLeft"),e.getCursor()},moveToEndOfDisplayLine:function(e){e.execCommand("goLineRight");var t=e.getCursor();return"before"==t.sticky&&t.ch--,t},textObjectManipulation:function(t,n,r,i){var a,s,l,c,u,h,d,m,p,f=r.selectedCharacter||"";"b"==f?f="(":"B"==f&&(f="{");var g=!r.textObjectInner;if(({"(":")",")":"(","{":"}","}":"{","[":"]","]":"[","<":">",">":"<"})[f]){if(p=!0,!(m=eE(t,n,f,g))){var v=t.getSearchCursor(RegExp("\\"+f,"g"),n);v.find()&&(m=eE(t,v.from(),f,g))}}else if(({"'":!0,'"':!0,"`":!0})[f])p=!0,m=function(e,t,n,r){var i,a,s,l,c=er(t),u=e.getLine(c.line).split(""),h=u.indexOf(n);if(c.ch<h)c.ch=h;else if(h<c.ch&&u[c.ch]==n){var d=/string/.test(e.getTokenTypeAt(et(t,0,1))),m=/string/.test(e.getTokenTypeAt(t));!(d&&!m)&&(a=c.ch,--c.ch)}if(u[c.ch]!=n||a)for(s=c.ch;s>-1&&!i;s--)u[s]==n&&(i=s+1);else i=c.ch+1;if(i&&!a)for(s=i,l=u.length;s<l&&!a;s++)u[s]==n&&(a=s);return i&&a?(r&&(--i,++a),{start:new o(c.line,i),end:new o(c.line,a)}):{start:c,end:c}}(t,n,f,g);else if("W"===f||"w"===f)for(var y=r.repeat||1;y-- >0;){var C=ey(t,{inclusive:g,innerWord:!g,bigWord:"W"===f,noSymbol:"W"===f,multiline:!0},m&&m.end);C&&(m||(m=C),m.end=C.end)}else if("p"===f){if(m=eA(t,n,r.repeat,0,g),r.linewise=!0,i.visualMode)i.visualLine||(i.visualLine=!0);else{var x=i.inputState.operatorArgs;x&&(x.linewise=!0),m.end.line--}}else if("t"===f)m=function(t,n,r){if(!e.findMatchingTag||!e.findEnclosingTag)return{start:n,end:n};var i=e.findMatchingTag(t,n)||e.findEnclosingTag(t,n);return i&&i.open&&i.close?r?{start:i.open.from,end:i.close.to}:{start:i.open.to,end:i.close.from}:{start:n,end:n}}(t,n,g);else if("s"===f){var S=t.getLine(n.line);n.ch>0&&w(S[n.ch])&&(n.ch-=1);var M=eO(t,n,r.repeat,1,g),L=eO(t,n,r.repeat,-1,g);k(t.getLine(L.line)[L.ch])&&k(t.getLine(M.line)[M.ch-1])&&(L={line:L.line,ch:L.ch+1}),m={start:L,end:M}}return m?t.state.vim.visualMode?(a=m.start,s=m.end,l=p,u=t.state.vim.sel,h=l?a:u.head,d=l?a:u.anchor,eo(s,a)&&(c=s,s=a,a=c),eo(h,d)?(h=ea(a,h),d=es(d,s)):(d=ea(a,d),-1==(h=et(h=es(h,s),0,-1)).ch&&h.line!=t.firstLine()&&(h=new o(h.line-1,ec(t,h.line-1)))),[d,h]):[m.start,m.end]:null},repeatLastCharacterSearch:function(e,t,r){var i=n.lastCharacterSearch,o=r.repeat,a=r.forward===i.forward,s=(i.increment?1:0)*(a?-1:1);e.moveH(-s,"char"),r.inclusive=!!a;var l=eL(e,o,a,i.selectedCharacter);return l?(l.ch+=s,l):(e.moveH(s,"char"),t)}};function Z(e,t){for(var n=[],r=0;r<t;r++)n.push(e);return n}var X={change:function(e,t,r){var i,a,s=e.state.vim,l=r[0].anchor,c=r[0].head;if(s.visualMode){if(t.fullLine)c.ch=Number.MAX_VALUE,c.line--,e.setSelection(l,c),a=e.getSelection(),e.replaceSelection(""),i=l;else{a=e.getSelection();var u=Z("",r.length);e.replaceSelections(u),i=ea(r[0].head,r[0].anchor)}}else{a=e.getRange(l,c);var h=s.lastEditInputState;if(h?.motion=="moveByWords"&&!k(a)){var d=/\s+$/.exec(a);d&&h.motionArgs&&h.motionArgs.forward&&(c=et(c,0,-d[0].length),a=a.slice(0,-d[0].length))}t.linewise&&(l=new o(l.line,ev(e.getLine(l.line))),c.line>l.line&&(c=new o(c.line-1,Number.MAX_VALUE))),e.replaceRange("",l,c),i=l}n.registerController.pushText(t.registerName,"change",a,t.linewise,r.length>1),G.enterInsertMode(e,{head:i},e.state.vim)},delete:function(e,t,r){var i,a,s=e.state.vim;if(s.visualBlock){a=e.getSelection();var l=Z("",r.length);e.replaceSelections(l),i=ea(r[0].head,r[0].anchor)}else{var c=r[0].anchor,u=r[0].head;t.linewise&&u.line!=e.firstLine()&&c.line==e.lastLine()&&c.line==u.line-1&&(c.line==e.firstLine()?c.ch=0:c=new o(c.line-1,ec(e,c.line-1))),a=e.getRange(c,u),e.replaceRange("",c,u),i=c,t.linewise&&(i=z.moveToFirstNonWhiteSpaceCharacter(e,c))}return n.registerController.pushText(t.registerName,"delete",a,t.linewise,s.visualBlock),Y(e,i)},indent:function(e,t,n){var r=e.state.vim,i=r.visualMode?t.repeat||0:1;if(e.indentMore)for(var o=0;o<i;o++)t.indentRight?e.indentMore():e.indentLess();else{var a=n[0].anchor.line,s=r.visualBlock?n[n.length-1].anchor.line:n[0].head.line;t.linewise&&s--;for(var l=a;l<=s;l++)for(var o=0;o<i;o++)e.indentLine(l,t.indentRight)}return z.moveToFirstNonWhiteSpaceCharacter(e,n[0].anchor)},indentAuto:function(e,t,n){return e.execCommand("indentAuto"),z.moveToFirstNonWhiteSpaceCharacter(e,n[0].anchor)},hardWrap:function(e,t,n,r){if(e.hardWrap){var i=n[0].anchor.line,a=n[0].head.line;t.linewise&&a--;var s=e.hardWrap({from:i,to:a});return s>i&&t.linewise&&s--,t.keepCursor?r:new o(s,0)}},changeCase:function(e,n,r,i,o){for(var a=e.getSelections(),s=[],l=n.toLower,c=0;c<a.length;c++){var u=a[c],h="";if(!0===l)h=u.toLowerCase();else if(!1===l)h=u.toUpperCase();else for(var d=0;d<u.length;d++){var m=u.charAt(d);h+=t.test(m)?m.toLowerCase():m.toUpperCase()}s.push(h)}return(e.replaceSelections(s),n.shouldMoveCursor)?o:!e.state.vim.visualMode&&n.linewise&&r[0].anchor.line+1==r[0].head.line?z.moveToFirstNonWhiteSpaceCharacter(e,i):n.linewise?i:ea(r[0].anchor,r[0].head)},yank:function(e,t,r,i){var o=e.state.vim,a=e.getSelection(),s=o.visualMode?ea(o.sel.anchor,o.sel.head,r[0].head,r[0].anchor):i;return n.registerController.pushText(t.registerName,"yank",a,t.linewise,o.visualBlock),s}},G={jumpListWalk:function(e,t,r){if(!r.visualMode){var i=t.repeat||1,o=t.forward,a=n.jumpList.move(e,o?i:-i),s=a?a.find():void 0;s=s||e.getCursor(),e.setCursor(s)}},scroll:function(e,t,n){if(!n.visualMode){var r=t.repeat||1,i=e.defaultTextHeight(),o=e.getScrollInfo().top,a=i*r,s=t.forward?o+a:o-a,l=er(e.getCursor()),c=e.charCoords(l,"local");if(t.forward)s>c.top?(l.line+=(s-c.top)/i,l.line=Math.ceil(l.line),e.setCursor(l),c=e.charCoords(l,"local"),e.scrollTo(null,c.top)):e.scrollTo(null,s);else{var u=s+e.getScrollInfo().clientHeight;u<c.bottom?(l.line-=(c.bottom-u)/i,l.line=Math.floor(l.line),e.setCursor(l),c=e.charCoords(l,"local"),e.scrollTo(null,c.bottom-e.getScrollInfo().clientHeight)):e.scrollTo(null,s)}}},scrollToCursor:function(e,t){var n=e.getCursor().line,r=e.charCoords(new o(n,0),"local"),i=e.getScrollInfo().clientHeight,a=r.top;switch(t.position){case"center":a=r.bottom-i/2;break;case"bottom":var s=new o(n,e.getLine(n).length-1),l=e.charCoords(s,"local").bottom-a;a=a-i+l}e.scrollTo(null,a)},replayMacro:function(e,t,r){var i=t.selectedCharacter||"",o=t.repeat||1,a=n.macroModeState;for("@"==i?i=a.latestRegister:a.latestRegister=i;o--;)!function(e,t,r,i){var o=n.registerController.getRegister(i);if(":"==i){o.keyBuffer[0]&&ez.processCommand(e,o.keyBuffer[0]),r.isPlaying=!1;return}var a=o.keyBuffer,s=0;r.isPlaying=!0,r.replaySearchQueries=o.searchQueries.slice(0);for(var l=0;l<a.length;l++)for(var c,u,h=a[l],d=/<(?:[CSMA]-)*\w+>|./gi;c=d.exec(h);)if(u=c[0],B.handleKey(e,u,"macro"),t.insertMode){var m=o.insertModeChanges[s++].changes;n.macroModeState.lastInsertModeChanges.changes=m,e3(e,m,1),eZ(e)}r.isPlaying=!1}(e,r,a,i)},enterMacroRecordMode:function(e,t){var r=n.macroModeState,i=t.selectedCharacter;n.registerController.isValidRegister(i)&&r.enterMacroRecordMode(e,i)},toggleOverwrite:function(t){t.state.overwrite?(t.toggleOverwrite(!1),t.setOption("keyMap","vim-insert"),e.signal(t,"vim-mode-change",{mode:"insert"})):(t.toggleOverwrite(!0),t.setOption("keyMap","vim-replace"),e.signal(t,"vim-mode-change",{mode:"replace"}))},enterInsertMode:function(t,r,i){if(!t.getOption("readOnly")){i.insertMode=!0,i.insertModeRepeat=r&&r.repeat||1;var s=r?r.insertAt:null,l=i.sel,c=r.head||t.getCursor("head"),u=t.listSelections().length;if("eol"==s)c=new o(c.line,ec(t,c.line));else if("bol"==s)c=new o(c.line,0);else if("charAfter"==s){var h=a(t,c,et(c,0,1));c=h.end}else if("firstNonBlank"==s){var h=a(t,c,z.moveToFirstNonWhiteSpaceCharacter(t,c));c=h.end}else if("startOfSelectedArea"==s){if(!i.visualMode)return;i.visualBlock?(c=new o(Math.min(l.head.line,l.anchor.line),Math.min(l.head.ch,l.anchor.ch)),u=Math.abs(l.head.line-l.anchor.line)+1):c=l.head.line<l.anchor.line?l.head:new o(l.anchor.line,0)}else if("endOfSelectedArea"==s){if(!i.visualMode)return;i.visualBlock?(c=new o(Math.min(l.head.line,l.anchor.line),Math.max(l.head.ch,l.anchor.ch)+1),u=Math.abs(l.head.line-l.anchor.line)+1):c=l.head.line>=l.anchor.line?et(l.head,0,1):new o(l.anchor.line,0)}else if("inplace"==s){if(i.visualMode)return}else"lastEdit"==s&&(c=eq(t)||c);t.setOption("disableInput",!1),r&&r.replace?(t.toggleOverwrite(!0),t.setOption("keyMap","vim-replace"),e.signal(t,"vim-mode-change",{mode:"replace"})):(t.toggleOverwrite(!1),t.setOption("keyMap","vim-insert"),e.signal(t,"vim-mode-change",{mode:"insert"})),n.macroModeState.isPlaying||(t.on("change",eG),i.insertEnd&&i.insertEnd.clear(),i.insertEnd=t.setBookmark(c,{insertLeft:!0}),e.on(t.getInputField(),"keydown",e6)),i.visualMode&&eg(t),ed(t,c,u)}},toggleVisualMode:function(t,n,r){var i,s=n.repeat,l=t.getCursor();if(r.visualMode)!!n.linewise!=r.visualLine||!!n.blockwise!=r.visualBlock?(r.visualLine=!!n.linewise,r.visualBlock=!!n.blockwise,e.signal(t,"vim-mode-change",{mode:"visual",subMode:r.visualLine?"linewise":r.visualBlock?"blockwise":""}),ep(t)):eg(t);else{r.visualMode=!0,r.visualLine=!!n.linewise,r.visualBlock=!!n.blockwise,i=Y(t,new o(l.line,l.ch+s-1));var c=a(t,l,i);r.sel={anchor:c.start,head:c.end},e.signal(t,"vim-mode-change",{mode:"visual",subMode:r.visualLine?"linewise":r.visualBlock?"blockwise":""}),ep(t),eb(t,r,"<",ea(l,i)),eb(t,r,">",es(l,i))}},reselectLastSelection:function(t,n,r){var i=r.lastSelection;if(r.visualMode&&em(t,r),i){var o=i.anchorMark.find(),a=i.headMark.find();if(!o||!a)return;r.sel={anchor:o,head:a},r.visualMode=!0,r.visualLine=i.visualLine,r.visualBlock=i.visualBlock,ep(t),eb(t,r,"<",ea(o,a)),eb(t,r,">",es(o,a)),e.signal(t,"vim-mode-change",{mode:"visual",subMode:r.visualLine?"linewise":r.visualBlock?"blockwise":""})}},joinLines:function(e,t,n){if(n.visualMode){if(r=e.getCursor("anchor"),eo(i=e.getCursor("head"),r)){var r,i,a=i;i=r,r=a}i.ch=ec(e,i.line)-1}else{var s=Math.max(t.repeat,2);r=e.getCursor(),i=Y(e,new o(r.line+s-1,1/0))}for(var l=0,c=r.line;c<i.line;c++){l=ec(e,r.line);var u="",h=0;if(!t.keepSpaces){var d=e.getLine(r.line+1);-1==(h=d.search(/\S/))?h=d.length:u=" "}e.replaceRange(u,new o(r.line,l),new o(r.line+1,h))}var m=Y(e,new o(r.line,l));n.visualMode&&eg(e,!1),e.setCursor(m)},newLineAndEnterInsertMode:function(t,n,r){r.insertMode=!0;var i=er(t.getCursor());i.line!==t.firstLine()||n.after?(i.line=n.after?i.line:i.line-1,i.ch=ec(t,i.line),t.setCursor(i),(e.commands.newlineAndIndentContinueComment||e.commands.newlineAndIndent)(t)):(t.replaceRange("\n",new o(t.firstLine(),0)),t.setCursor(t.firstLine(),0)),this.enterInsertMode(t,{repeat:n.repeat},r)},paste:function(e,t,r){var i=n.registerController.getRegister(t.registerName);if("+"===t.registerName)navigator.clipboard.readText().then(n=>{this.continuePaste(e,t,r,n,i)});else{var o=i.toString();this.continuePaste(e,t,r,o,i)}},continuePaste:function(e,t,r,i,a){var s=er(e.getCursor());if(i){if(t.matchIndent){var l=e.getOption("tabSize"),c=function(e){return(e.split("	").length-1)*l+1*(e.split(" ").length-1)},u=c(e.getLine(e.getCursor().line).match(/^\s*/)[0]),h=i.replace(/\n$/,""),d=i!==h,m=c(i.match(/^\s*/)[0]),i=h.replace(/^\s*/gm,function(t){var n=u+(c(t)-m);return n<0?"":e.getOption("indentWithTabs")?Array(Math.floor(n/l)+1).join("	"):Array(n+1).join(" ")});i+=d?"\n":""}if(t.repeat>1)var i=Array(t.repeat+1).join(i);var p=a.linewise,f=a.blockwise;if(f){i=i.split("\n"),p&&i.pop();for(var g=0;g<i.length;g++)i[g]=""==i[g]?" ":i[g];s.ch+=t.after?1:0,s.ch=Math.min(ec(e,s.line),s.ch)}else p?r.visualMode?i=r.visualLine?i.slice(0,-1):"\n"+i.slice(0,i.length-1)+"\n":t.after?(i="\n"+i.slice(0,i.length-1),s.ch=ec(e,s.line)):s.ch=0:s.ch+=t.after?1:0;if(r.visualMode){r.lastPastedText=i;var v,y,C,k,w,x,S=(k=r.lastSelection,r.visualMode?(y=(v=e.listSelections())[0],C=v[v.length-1],[eo(y.anchor,y.head)?y.anchor:y.head,eo(C.anchor,C.head)?C.head:C.anchor]):function(){var t=e.getCursor(),n=e.getCursor(),r=k.visualBlock;if(r){var i=r.width,a=r.height;n=new o(t.line+a,t.ch+i);for(var s=[],l=t.line;l<n.line;l++){var c={anchor:new o(l,t.ch),head:new o(l,n.ch)};s.push(c)}e.setSelections(s)}else{var u=k.anchorMark.find(),h=k.headMark.find(),d=h.line-u.line,m=h.ch-u.ch;n={line:n.line+d,ch:d?n.ch:m+n.ch},k.visualLine&&(t=new o(t.line,0),n=new o(n.line,ec(e,n.line))),e.setSelection(t,n)}return[t,n]}()),M=S[0],L=S[1],b=e.getSelection(),A=Array(e.listSelections().length).join("1").split("1");r.lastSelection&&(x=r.lastSelection.headMark.find()),n.registerController.unnamedRegister.setText(b),f?(e.replaceSelections(A),L=new o(M.line+i.length-1,M.ch),e.setCursor(M),eh(e,L),e.replaceSelections(i),w=M):r.visualBlock?(e.replaceSelections(A),e.setCursor(M),e.replaceRange(i,M,M),w=M):(e.replaceRange(i,M,L),w=e.posFromIndex(e.indexFromPos(M)+i.length-1)),x&&(r.lastSelection.headMark=e.setBookmark(x)),p&&(w.ch=0)}else if(f){e.setCursor(s);for(var g=0;g<i.length;g++){var O=s.line+g;O>e.lastLine()&&e.replaceRange("\n",new o(O,0)),ec(e,O)<s.ch&&function(e,t,n){var r=ec(e,t),i=Array(n-r+1).join(" ");e.setCursor(new o(t,r)),e.replaceRange(i,e.getCursor())}(e,O,s.ch)}e.setCursor(s),eh(e,new o(s.line+i.length-1,s.ch)),e.replaceSelections(i),w=s}else if(e.replaceRange(i,s),p){var O=t.after?s.line+1:s.line;w=new o(O,ev(e.getLine(O)))}else w=er(s),/\n/.test(i)||(w.ch+=i.length-(t.after?1:0));r.visualMode&&eg(e,!1),e.setCursor(w)}},undo:function(t,n){t.operation(function(){en(t,e.commands.undo,n.repeat)(),t.setCursor(Y(t,t.getCursor("start")))})},redo:function(t,n){en(t,e.commands.redo,n.repeat)()},setRegister:function(e,t,n){n.inputState.registerName=t.selectedCharacter},insertRegister:function(e,t,r){var i=t.selectedCharacter,o=n.registerController.getRegister(i),a=o&&o.toString();a&&e.replaceSelection(a)},oneNormalCommand:function(t,n,r){eZ(t,!0),r.insertModeReturn=!0,e.on(t,"vim-command-done",function n(){r.visualMode||(r.insertModeReturn&&(r.insertModeReturn=!1,r.insertMode||G.enterInsertMode(t,{},r)),e.off(t,"vim-command-done",n))})},setMark:function(e,t,n){var r=t.selectedCharacter;r&&eb(e,n,r,e.getCursor())},replace:function(t,n,r){var i,s,l=n.selectedCharacter||"",c=t.getCursor(),u=t.listSelections();if(r.visualMode)c=t.getCursor("start"),s=t.getCursor("end");else{var h=t.getLine(c.line);(i=c.ch+n.repeat)>h.length&&(i=h.length),s=new o(c.line,i)}var d=a(t,c,s);if(c=d.start,s=d.end,"\n"==l)r.visualMode||t.replaceRange("",c,s),(e.commands.newlineAndIndentContinueComment||e.commands.newlineAndIndent)(t);else{var m=t.getRange(c,s);if(m=(m=m.replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,l)).replace(/[^\n]/g,l),r.visualBlock){var p=Array(t.getOption("tabSize")+1).join(" "),f=(m=(m=t.getSelection()).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,l)).replace(/\t/g,p).replace(/[^\n]/g,l).split("\n");t.replaceSelections(f)}else t.replaceRange(m,c,s);r.visualMode?(c=eo(u[0].anchor,u[0].head)?u[0].anchor:u[0].head,t.setCursor(c),eg(t,!1)):t.setCursor(et(s,0,-1))}},incrementNumberToken:function(e,t){for(var n,r,i,a,s=e.getCursor(),l=e.getLine(s.line),c=/(-?)(?:(0x)([\da-f]+)|(0b|0|)(\d+))/gi;null!==(n=c.exec(l))&&(i=(r=n.index)+n[0].length,!(s.ch<i)););if(t.backtrack||!(i<=s.ch)){if(!n)return;var u=n[2]||n[4],h=n[3]||n[5],d=t.increase?1:-1,m={"0b":2,0:8,"":10,"0x":16}[u.toLowerCase()];a=(parseInt(n[1]+h,m)+d*t.repeat).toString(m);var p=u?Array(h.length-a.length+1+n[1].length).join("0"):"";a="-"===a.charAt(0)?"-"+u+p+a.substr(1):u+p+a;var f=new o(s.line,r),g=new o(s.line,i);e.replaceRange(a,f,g),e.setCursor(new o(s.line,r+a.length-1))}},repeatLastEdit:function(e,t,n){var r=n.lastEditInputState;if(r){var i=t.repeat;i&&t.repeatIsExplicit?r.repeatOverride=i:i=r.repeatOverride||i,e2(e,n,i,!1)}},indent:function(e,t){e.indentLine(e.getCursor().line,t.indentRight)},exitInsertMode:function(e,t){eZ(e)}};function Y(e,t,n){var r=e.state.vim,i=r.insertMode||r.visualMode,a=Math.min(Math.max(e.firstLine(),t.line),e.lastLine()),s=e.getLine(a),l=s.length-1+Number(!!i),c=Math.min(Math.max(0,t.ch),l),u=s.charCodeAt(c);if(56320<=u&&u<=57343){var h=1;n&&n.line==a&&n.ch>c&&(h=-1),(c+=h)>l&&(c-=2)}return new o(a,c)}function ee(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}function et(e,t,n){return"object"==typeof t&&(n=t.ch,t=t.line),new o(e.line+t,e.ch+n)}function en(e,t,n){return function(){for(var r=0;r<n;r++)t(e)}}function er(e){return new o(e.line,e.ch)}function ei(e,t){return e.ch==t.ch&&e.line==t.line}function eo(e,t){return e.line<t.line||e.line==t.line&&e.ch<t.ch}function ea(e,t){return arguments.length>2&&(t=ea.apply(void 0,Array.prototype.slice.call(arguments,1))),eo(e,t)?e:t}function es(e,t){return arguments.length>2&&(t=es.apply(void 0,Array.prototype.slice.call(arguments,1))),eo(e,t)?t:e}function el(e,t,n){var r=eo(e,t),i=eo(t,n);return r&&i}function ec(e,t){return e.getLine(t).length}function eu(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function eh(e,t){var n=[],r=e.listSelections(),i=er(e.clipPos(t)),a=!ei(t,i),s=function(e,t,n){for(var r=0;r<e.length;r++){var i=ei(e[r].anchor,t),o=ei(e[r].head,t);if(i||o)return r}return -1}(r,e.getCursor("head")),l=ei(r[s].head,r[s].anchor),c=r.length-1,u=c-s>s?c:0,h=r[u].anchor,d=Math.min(h.line,i.line),m=Math.max(h.line,i.line),p=h.ch,f=i.ch,g=r[u].head.ch-p,v=f-p;g>0&&v<=0?(p++,!a&&f--):g<0&&v>=0?(p--,!l&&f++):g<0&&-1==v&&(p--,f++);for(var y=d;y<=m;y++){var C={anchor:new o(y,p),head:new o(y,f)};n.push(C)}return e.setSelections(n),t.ch=f,h.ch=p,h}function ed(e,t,n){for(var r=[],i=0;i<n;i++){var o=et(t,i,0);r.push({anchor:o,head:o})}e.setSelections(r,0)}function em(e,t){var n=t.sel.anchor,r=t.sel.head;t.lastPastedText&&(r=e.posFromIndex(e.indexFromPos(n)+t.lastPastedText.length),t.lastPastedText=null),t.lastSelection={anchorMark:e.setBookmark(n),headMark:e.setBookmark(r),anchor:er(n),head:er(r),visualMode:t.visualMode,visualLine:t.visualLine,visualBlock:t.visualBlock}}function ep(e,t,n){var r=e.state.vim;t=t||r.sel,n||(n=r.visualLine?"line":r.visualBlock?"block":"char");var i=ef(e,t,n);e.setSelections(i.ranges,i.primary)}function ef(e,t,n,r){var i=er(t.head),a=er(t.anchor);if("char"==n){var s=r||eo(t.head,t.anchor)?0:1,l=eo(t.head,t.anchor)?1:0;return i=et(t.head,0,s),{ranges:[{anchor:a=et(t.anchor,0,l),head:i}],primary:0}}if("line"==n){if(eo(t.head,t.anchor))i.ch=0,a.ch=ec(e,a.line);else{a.ch=0;var c=e.lastLine();i.line>c&&(i.line=c),i.ch=ec(e,i.line)}return{ranges:[{anchor:a,head:i}],primary:0}}if("block"==n){var u=Math.min(a.line,i.line),h=a.ch,d=Math.max(a.line,i.line),m=i.ch;h<m?m+=1:h+=1;for(var p=d-u+1,f=i.line==u?0:p-1,g=[],v=0;v<p;v++)g.push({anchor:new o(u+v,h),head:new o(u+v,m)});return{ranges:g,primary:f}}throw"never happens"}function eg(t,n){var r=t.state.vim;!1!==n&&t.setCursor(Y(t,r.sel.head)),em(t,r),r.visualMode=!1,r.visualLine=!1,r.visualBlock=!1,r.insertMode||e.signal(t,"vim-mode-change",{mode:"normal"})}function ev(e){if(!e)return 0;var t=e.search(/\S/);return -1==t?e.length:t}function ey(e,{inclusive:t,innerWord:n,bigWord:r,noSymbol:i,multiline:a},s){var l,c,u=s||(l=e.getCursor("head"),1==e.getSelection().length&&(l=ea(l,e.getCursor("anchor"))),l),h=e.getLine(u.line),d=h,f=u.line,g=f,v=u.ch,y=i?m[0]:p[0];if(n&&/\s/.test(h.charAt(v)))y=function(e){return/\s/.test(e)};else{for(;!y(h.charAt(v));)if(++v>=h.length){if(!a)return null;v--,c=eS(e,u,!0,r,!0);break}r?y=p[0]:(y=m[0])(h.charAt(v))||(y=m[1])}for(var C=v,k=v;y(h.charAt(k))&&k>=0;)k--;if(k++,c)C=c.to,g=c.line,!(d=e.getLine(g))&&0==C&&C++;else for(;y(h.charAt(C))&&C<h.length;)C++;if(t){var w=C,x=u.ch<=k&&/\s/.test(h.charAt(u.ch));if(!x)for(;/\s/.test(d.charAt(C))&&C<d.length;)C++;if(w==C||x){for(var S=k;/\s/.test(h.charAt(k-1))&&k>0;)k--;k||x||(k=S)}}return{start:new o(f,k),end:new o(g,C)}}function eC(e,t,r){ei(t,r)||n.jumpList.add(e,t,r)}function ek(e,t){n.lastCharacterSearch.increment=e,n.lastCharacterSearch.forward=t.forward,n.lastCharacterSearch.selectedCharacter=t.selectedCharacter}var ew={"(":"bracket",")":"bracket","{":"bracket","}":"bracket","[":"section","]":"section","*":"comment","/":"comment",m:"method",M:"method","#":"preprocess"},ex={bracket:{isComplete:function(e){if(e.nextCh===e.symb){if(e.depth++,e.depth>=1)return!0}else e.nextCh===e.reverseSymb&&e.depth--;return!1}},section:{init:function(e){e.curMoveThrough=!0,e.symb=(e.forward?"]":"[")===e.symb?"{":"}"},isComplete:function(e){return 0===e.index&&e.nextCh===e.symb}},comment:{isComplete:function(e){var t="*"===e.lastCh&&"/"===e.nextCh;return e.lastCh=e.nextCh,t}},method:{init:function(e){e.symb="m"===e.symb?"{":"}",e.reverseSymb="{"===e.symb?"}":"{"},isComplete:function(e){return e.nextCh===e.symb}},preprocess:{init:function(e){e.index=0},isComplete:function(e){if("#"===e.nextCh){var t=e.lineText.match(/^#(\w+)/)[1];if("endif"===t){if(e.forward&&0===e.depth)return!0;e.depth++}else if("if"===t){if(!e.forward&&0===e.depth)return!0;e.depth--}if("else"===t&&0===e.depth)return!0}return!1}}};function eS(e,t,n,r,i){var o=t.line,a=t.ch,s=e.getLine(o),l=n?1:-1,c=r?p:m;if(i&&""==s){if(o+=l,s=e.getLine(o),!y(e,o))return null;a=n?0:s.length}for(;;){if(i&&""==s)return{from:0,to:0,line:o};for(var u=l>0?s.length:-1,h=u,d=u;a!=u;){for(var f=!1,g=0;g<c.length&&!f;++g)if(c[g](s.charAt(a))){for(h=a;a!=u&&c[g](s.charAt(a));)a+=l;if(f=h!=(d=a),h==t.ch&&o==t.line&&d==h+l)continue;return{from:Math.min(h,d+1),to:Math.max(h,d),line:o}}f||(a+=l)}if(!y(e,o+=l))return null;s=e.getLine(o),a=l>0?0:s.length}}function eM(e,t,n,r,i){var a=new o(t.line+n.repeat-1,1/0),s=e.clipPos(a);return s.ch--,i||(r.lastHPos=1/0,r.lastHSPos=e.charCoords(s,"div").left),a}function eL(e,t,n,r,i){if(r){for(var a,s=i||e.getCursor(),l=s.ch,c=0;c<t;c++){if(-1==(a=function(e,t,n,r,i){var o;return r?-1==(o=t.indexOf(n,e+1))||i||(o-=1):-1==(o=t.lastIndexOf(n,e-1))||i||(o+=1),o}(l,e.getLine(s.line),r,n,!0)))return;l=a}if(void 0!=a)return new o(e.getCursor().line,a)}}function eb(e,t,n,r){(x(n,f)||v.test(n))&&(t.marks[n]&&t.marks[n].clear(),t.marks[n]=e.setBookmark(r))}function eA(e,t,n,r,i){var a,s=t.line,l=e.firstLine(),c=e.lastLine(),u=s;function h(t){return!e.getLine(t)}function d(e,t,n){return n?h(e)!=h(e+t):!h(e)&&h(e+t)}if(r){for(;l<=u&&u<=c&&n>0;)d(u,r)&&n--,u+=r;return{start:new o(u,0),end:t}}var m=e.state.vim;if(m.visualLine&&d(s,1,!0)){var p=m.sel.anchor;d(p.line,-1,!0)&&(!i||p.line!=s)&&(s+=1)}var f=h(s);for(u=s;u<=c&&n;u++)d(u,1,!0)&&(!i||h(u)!=f)&&n--;for(a=new o(u,0),u>c&&!f?f=!0:i=!1,u=s;u>l&&!((!i||h(u)==f||u==s)&&d(u,-1,!0));u--);return{start:new o(u,0),end:a}}function eO(e,t,n,r,i){function a(e){e.pos+e.dir<0||e.pos+e.dir>=e.line.length?e.line=null:e.pos+=e.dir}for(var s={ln:t.line,pos:t.ch};n>0;)s=r<0?function(e,t,n,r){var o=e.getLine(t),s={line:o,ln:t,pos:n,dir:r};if(""===s.line)return{ln:s.ln,pos:s.pos};var l=s.pos;for(a(s);null!==s.line;){if(k(s.line[s.pos])||w(s.line[s.pos])){if(w(s.line[s.pos])){if(!i)return{ln:s.ln,pos:l};if(k(s.line[s.pos+1]))return{ln:s.ln,pos:s.pos+1};return{ln:s.ln,pos:l}}}else l=s.pos;a(s)}return(s.line=o,i&&k(s.line[s.pos]))?{ln:s.ln,pos:s.pos}:{ln:s.ln,pos:l}}(e,s.ln,s.pos,r):function(e,t,n,r){var o={line:e.getLine(t),ln:t,pos:n,dir:r};if(""===o.line)return{ln:o.ln,pos:o.pos};var s=o.pos;for(a(o);null!==o.line;){if(s=o.pos,w(o.line[o.pos])){if(!i)return{ln:o.ln,pos:o.pos+1};for(a(o);null!==o.line;)if(k(o.line[o.pos]))s=o.pos,a(o);else break;break}a(o)}return{ln:o.ln,pos:s+1}}(e,s.ln,s.pos,r),n--;return new o(s.ln,s.pos)}function eE(e,t,n,r){var i={"(":/[()]/,")":/[()]/,"[":/[[\]]/,"]":/[[\]]/,"{":/[{}]/,"}":/[{}]/,"<":/[<>]/,">":/[<>]/}[n],a=e.getLine(t.line).charAt(t.ch)===({"(":"(",")":"(","[":"[","]":"[","{":"{","}":"{","<":"<",">":"<"})[n]?1:0,s=e.scanForBracket(new o(t.line,t.ch+a),-1,void 0,{bracketRegex:i}),l=e.scanForBracket(new o(t.line,t.ch+a),1,void 0,{bracketRegex:i});if(!s||!l)return null;var c=s.pos,u=l.pos;if(c.line==u.line&&c.ch>u.ch||c.line>u.line){var h=c;c=u,u=h}return r?u.ch+=1:c.ch+=1,{start:c,end:u}}M("pcre",!0,"boolean");class eT{getQuery(){return n.query}setQuery(e){n.query=e}getOverlay(){return this.searchOverlay}setOverlay(e){this.searchOverlay=e}isReversed(){return n.isReversed}setReversed(e){n.isReversed=e}getScrollbarAnnotate(){return this.annotate}setScrollbarAnnotate(e){this.annotate=e}}function eR(e){var t=e.state.vim;return t.searchState_||(t.searchState_=new eT)}function eB(e,t){var n=eN(e,t)||[];if(!n.length)return[];var r=[];if(0===n[0]){for(var i=0;i<n.length;i++)"number"==typeof n[i]&&r.push(e.substring(n[i]+1,n[i+1]));return r}}function eN(e,t){t||(t="/");for(var n=!1,r=[],i=0;i<e.length;i++){var o=e.charAt(i);n||o!=t||r.push(i),n=!n&&"\\"==o}return r}var eI={"\\n":"\n","\\r":"\r","\\t":"	"},eK={"\\/":"/","\\\\":"\\","\\n":"\n","\\r":"\r","\\t":"	","\\&":"&"};function eP(e){"string"==typeof e&&(e=document.createElement(e));for(var t,n=1;n<arguments.length;n++)if(t=arguments[n]){if("object"!=typeof t&&(t=document.createTextNode(t)),t.nodeType)e.appendChild(t);else for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&("$"===r[0]?e.style[r.slice(1)]=t[r]:e.setAttribute(r,t[r]))}return e}function eD(e,t){var n=eP("div",{$color:"red",$whiteSpace:"pre",class:"cm-vim-message"},t);e.openNotification?e.openNotification(n,{bottom:!0,duration:5e3}):alert(n.innerText)}function eF(e,t){if(N.length){t.value||(t.value=""),i=t;return}var n,r,o=(n=t.prefix,r=t.desc,eP("div",{$display:"flex"},eP("span",{$fontFamily:"monospace",$whiteSpace:"pre",$flex:1},n,eP("input",{type:"text",autocorrect:"off",autocapitalize:"off",spellcheck:"false",$width:"100%"})),r&&eP("span",{$color:"#888"},r)));if(e.openDialog)e.openDialog(o,t.onClose,{onKeyDown:t.onKeyDown,onKeyUp:t.onKeyUp,bottom:!0,selectValueOnOpen:!1,value:t.value});else{var a="";"string"!=typeof t.prefix&&t.prefix&&(a+=t.prefix.textContent),t.desc&&(a+=" "+t.desc),t.onClose(prompt(a,""))}}function eH(e,t,r,i){if(t){var o=eR(e),a=function(e,t,r){if(n.registerController.getRegister("/").setText(e),e instanceof RegExp)return e;var i,o,a=eN(e,"/");return(a.length?(i=e.substring(0,a[0]),o=-1!=e.substring(a[0]).indexOf("i")):i=e,i)?(b("pcre")||(i=function(e){for(var t=!1,n=[],r=-1;r<e.length;r++){var i=e.charAt(r)||"",o=e.charAt(r+1)||"",a=o&&-1!="|(){".indexOf(o);t?("\\"===i&&a||n.push(i),t=!1):"\\"===i?(t=!0,o&&-1!="}".indexOf(o)&&(a=!0),a&&"\\"!==o||n.push(i)):(n.push(i),a&&"\\"!==o&&n.push("\\"))}return n.join("")}(i)),r&&(t=/^[^A-Z]*$/.test(i)),new RegExp(i,t||o?"im":"m")):null}(t,!!r,!!i);return a?(ej(e,a),function(e,t){if(e instanceof RegExp&&t instanceof RegExp){for(var n=["global","multiline","ignoreCase","source"],r=0;r<n.length;r++){var i=n[r];if(e[i]!==t[i])return!1}return!0}return!1}(a,o.getQuery())||o.setQuery(a),a):void 0}}var e_=0;function ej(e,t){clearTimeout(e_),eR(e).highlightTimeout=e_,e_=setTimeout(function(){if(e.state.vim){var n=eR(e);n.highlightTimeout=null;var r=n.getOverlay();r&&t==r.query||(r&&e.removeOverlay(r),r=function(e){if("^"==e.source.charAt(0))var t=!0;return{token:function(n){if(t&&!n.sol()){n.skipToEnd();return}var r=n.match(e,!1);if(r)return 0==r[0].length?(n.next(),"searching"):n.sol()||(n.backUp(1),e.exec(n.next()+r[0]))?(n.match(e),"searching"):(n.next(),null);for(;!n.eol()&&(n.next(),!n.match(e,!1)););},query:e}}(t),e.addOverlay(r),e.showMatchesOnScrollbar&&(n.getScrollbarAnnotate()&&n.getScrollbarAnnotate().clear(),n.setScrollbarAnnotate(e.showMatchesOnScrollbar(t))),n.setOverlay(r))}},50)}function eV(e,t,n,r){return e.operation(function(){void 0===r&&(r=1);for(var i=e.getCursor(),a=e.getSearchCursor(n,i),s=0;s<r;s++){var l=a.find(t);if(0==s&&l&&ei(a.from(),i)){var c=t?a.from():a.to();(l=a.find(t))&&!l[0]&&ei(a.from(),c)&&e.getLine(c.line).length==c.ch&&(l=a.find(t))}if(!l&&!(a=e.getSearchCursor(n,t?new o(e.lastLine()):new o(e.firstLine(),0))).find(t))return}return a.from()})}function eW(e){var t=eR(e);t.highlightTimeout&&(clearTimeout(t.highlightTimeout),t.highlightTimeout=null),e.removeOverlay(eR(e).getOverlay()),t.setOverlay(null),t.getScrollbarAnnotate()&&(t.getScrollbarAnnotate().clear(),t.setScrollbarAnnotate(null))}function e$(e){var t=e.getScrollInfo(),n=e.coordsChar({left:0,top:6+t.top},"local"),r=t.clientHeight-10+t.top,i=e.coordsChar({left:0,top:r},"local");return{top:n.line,bottom:i.line}}function eU(e,t,r){if("'"==r||"`"==r)return n.jumpList.find(e,-1)||new o(0,0);if("."==r)return eq(e);var i=t.marks[r];return i&&i.find()}function eq(e){if(e.getLastEditEnd)return e.getLastEditEnd();for(var t=e.doc.history.done,n=t.length;n--;)if(t[n].changes)return er(t[n].changes[0].to)}class eQ{constructor(){this.commandMap_,this.buildCommandMap_()}processCommand(e,t,n){var r=this;e.operation(function(){e.curOp.isVimOp=!0,r._processCommand(e,t,n)})}_processCommand(t,r,i){var o,a,s=t.state.vim,l=n.registerController.getRegister(":"),c=l.toString(),u=new e.StringStream(r);l.setText(r);var h=i||{};h.input=r;try{this.parseInput_(t,u,h)}catch(e){throw eD(t,e+""),e}if(s.visualMode&&eg(t),h.commandName){if(o=this.matchCommand_(h.commandName)){if(a=o.name,o.excludeFromCommandHistory&&l.setText(c),this.parseCommandArgs_(u,h,o),"exToKey"==o.type){K(t,o.toKeys,o);return}if("exToEx"==o.type){this.processCommand(t,o.toInput);return}}}else void 0!==h.line&&(a="move");if(!a){eD(t,'Not an editor command ":'+r+'"');return}try{eJ[a](t,h),o&&o.possiblyAsync||!h.callback||h.callback()}catch(e){throw eD(t,e+""),e}}parseInput_(e,t,n){t.eatWhile(":"),t.eat("%")?(n.line=e.firstLine(),n.lineEnd=e.lastLine()):(n.line=this.parseLineSpec_(e,t),void 0!==n.line&&t.eat(",")&&(n.lineEnd=this.parseLineSpec_(e,t))),void 0==n.line?e.state.vim.visualMode?(n.selectionLine=eU(e,e.state.vim,"<")?.line,n.selectionLineEnd=eU(e,e.state.vim,">")?.line):n.selectionLine=e.getCursor().line:(n.selectionLine=n.line,n.selectionLineEnd=n.lineEnd);var r=t.match(/^(\w+|!!|@@|[!#&*<=>@~])/);return r?n.commandName=r[1]:n.commandName=t.match(/.*/)[0],n}parseLineSpec_(e,t){var n=t.match(/^(\d+)/);if(n)return parseInt(n[1],10)-1;switch(t.next()){case".":return this.parseLineSpecOffset_(t,e.getCursor().line);case"$":return this.parseLineSpecOffset_(t,e.lastLine());case"'":var r=t.next(),i=eU(e,e.state.vim,r);if(!i)throw Error("Mark not set");return this.parseLineSpecOffset_(t,i.line);case"-":case"+":return t.backUp(1),this.parseLineSpecOffset_(t,e.getCursor().line);default:t.backUp(1);return}}parseLineSpecOffset_(e,t){var n=e.match(/^([+-])?(\d+)/);if(n){var r=parseInt(n[2],10);"-"==n[1]?t-=r:t+=r}return t}parseCommandArgs_(e,t,n){if(!e.eol()){t.argString=e.match(/.*/)[0];var r=n.argDelimiter||/\s+/,i=eu(t.argString).split(r);i.length&&i[0]&&(t.args=i)}}matchCommand_(e){for(var t=e.length;t>0;t--){var n=e.substring(0,t);if(this.commandMap_[n]){var r=this.commandMap_[n];if(0===r.name.indexOf(e))return r}}return null}buildCommandMap_(){this.commandMap_={};for(var e=0;e<c.length;e++){var t=c[e],n=t.shortName||t.name;this.commandMap_[n]=t}}map(e,t,n,r){if(":"!=e&&":"==e.charAt(0)){if(n)throw Error("Mode not supported for ex mappings");var i=e.substring(1);":"!=t&&":"==t.charAt(0)?this.commandMap_[i]={name:i,type:"exToEx",toInput:t.substring(1),user:!0}:this.commandMap_[i]={name:i,type:"exToKey",toKeys:t,user:!0}}else{var o={keys:e,type:"keyToKey",toKeys:t,noremap:!!r};n&&(o.context=n),s.unshift(o)}}unmap(e,t){if(":"!=e&&":"==e.charAt(0)){if(t)throw Error("Mode not supported for ex mappings");var n=e.substring(1);if(this.commandMap_[n]&&this.commandMap_[n].user)return delete this.commandMap_[n],!0}else for(var r=0;r<s.length;r++)if(e==s[r].keys&&s[r].context===t)return s.splice(r,1),!0}}var eJ={colorscheme:function(e,t){if(!t.args||t.args.length<1){eD(e,e.getOption("theme"));return}e.setOption("theme",t.args[0])},map:function(e,t,n,r){var i=t.args;if(!i||i.length<2){e&&eD(e,"Invalid mapping: "+t.input);return}ez.map(i[0],i[1],n,r)},imap:function(e,t){this.map(e,t,"insert")},nmap:function(e,t){this.map(e,t,"normal")},vmap:function(e,t){this.map(e,t,"visual")},omap:function(e,t){this.map(e,t,"operatorPending")},noremap:function(e,t){this.map(e,t,void 0,!0)},inoremap:function(e,t){this.map(e,t,"insert",!0)},nnoremap:function(e,t){this.map(e,t,"normal",!0)},vnoremap:function(e,t){this.map(e,t,"visual",!0)},onoremap:function(e,t){this.map(e,t,"operatorPending",!0)},unmap:function(e,t,n){var r=t.args;(!r||r.length<1||!ez.unmap(r[0],n))&&e&&eD(e,"No such mapping: "+t.input)},mapclear:function(e,t){B.mapclear()},imapclear:function(e,t){B.mapclear("insert")},nmapclear:function(e,t){B.mapclear("normal")},vmapclear:function(e,t){B.mapclear("visual")},omapclear:function(e,t){B.mapclear("operatorPending")},move:function(e,t){J.processCommand(e,e.state.vim,{keys:"",type:"motion",motion:"moveToLineOrEdgeOfDocument",motionArgs:{forward:!1,explicitRepeat:!0,linewise:!0},repeatOverride:t.line+1})},set:function(e,t){var n=t.args,r=t.setCfg||{};if(!n||n.length<1){e&&eD(e,"Invalid mapping: "+t.input);return}var i=n[0].split("="),o=i.shift()||"",a=i.length>0?i.join("="):void 0,s=!1,l=!1;if("?"==o.charAt(o.length-1)){if(a)throw Error("Trailing characters: "+t.argString);o=o.substring(0,o.length-1),s=!0}else"!"==o.charAt(o.length-1)&&(o=o.substring(0,o.length-1),l=!0);void 0===a&&"no"==o.substring(0,2)&&(o=o.substring(2),a=!1);var c=S[o]&&"boolean"==S[o].type;if(c&&(l?a=!b(o,e,r):void 0==a&&(a=!0)),!c&&void 0===a||s){var u=b(o,e,r);u instanceof Error?eD(e,u.message):!0===u||!1===u?eD(e," "+(u?"":"no")+o):eD(e,"  "+o+"="+u)}else{var h=L(o,a,e,r);h instanceof Error&&eD(e,h.message)}},setlocal:function(e,t){t.setCfg={scope:"local"},this.set(e,t)},setglobal:function(e,t){t.setCfg={scope:"global"},this.set(e,t)},registers:function(e,t){var r=t.args,i=n.registerController.registers,o="----------Registers----------\n\n";if(r)for(var a=r.join(""),s=0;s<a.length;s++){var l=a.charAt(s);if(n.registerController.isValidRegister(l)){var c=i[l]||new U;o+='"'+l+"    "+c.toString()+"\n"}}else for(var l in i){var u=i[l].toString();u.length&&(o+='"'+l+"    "+u+"\n")}eD(e,o)},sort:function(t,n){var r=function(){if(n.argString){var t=new e.StringStream(n.argString);if(t.eat("!")&&(g=!0),!t.eol()){if(!t.eatSpace())return"Invalid arguments";var r=t.match(/([dinuox]+)?\s*(\/.+\/)?\s*/);if(!r||!t.eol())return"Invalid arguments";if(r[1]){v=-1!=r[1].indexOf("i"),y=-1!=r[1].indexOf("u");var i=-1!=r[1].indexOf("d")||-1!=r[1].indexOf("n"),o=-1!=r[1].indexOf("x"),a=-1!=r[1].indexOf("o");if(Number(i)+Number(o)+Number(a)>1)return"Invalid arguments";C=i&&"decimal"||o&&"hex"||a&&"octal"}r[2]&&(k=new RegExp(r[2].substr(1,r[2].length-2),v?"i":""))}}}();if(r){eD(t,r+": "+n.argString);return}var i=n.line||t.firstLine(),a=n.lineEnd||n.line||t.lastLine();if(i!=a){var s=new o(i,0),l=new o(a,ec(t,a)),c=t.getRange(s,l).split("\n"),u="decimal"==C?/(-?)([\d]+)/:"hex"==C?/(-?)(?:0x)?([0-9a-f]+)/i:"octal"==C?/([0-7]+)/:null,h="decimal"==C?10:"hex"==C?16:"octal"==C?8:void 0,d=[],m=[];if(C||k)for(var p=0;p<c.length;p++){var f=k?c[p].match(k):null;f&&""!=f[0]?d.push(f):u&&u.exec(c[p])?d.push(c[p]):m.push(c[p])}else m=c;if(d.sort(k?function(e,t){if(g){var n;n=e,e=t,t=n}return v&&(e[0]=e[0].toLowerCase(),t[0]=t[0].toLowerCase()),e[0]<t[0]?-1:1}:S),k)for(var p=0;p<d.length;p++)d[p]=d[p].input;else C||m.sort(S);if(c=g?d.concat(m):m.concat(d),y){var g,v,y,C,k,w,x=c;c=[];for(var p=0;p<x.length;p++)x[p]!=w&&c.push(x[p]),w=x[p]}t.replaceRange(c.join("\n"),s,l)}function S(e,t){if(g){var n;n=e,e=t,t=n}v&&(e=e.toLowerCase(),t=t.toLowerCase());var r=u&&u.exec(e),i=u&&u.exec(t);return r&&i?parseInt((r[1]+r[2]).toLowerCase(),h)-parseInt((i[1]+i[2]).toLowerCase(),h):e<t?-1:1}},vglobal:function(e,t){this.global(e,t)},normal:function(e,t){var n=t.argString;if(n&&"!"==n[0]&&(n=n.slice(1),I=!0),!(n=n.trimStart())){eD(e,"Argument is required.");return}var r=t.line;if("number"==typeof r)for(var i=isNaN(t.lineEnd)?r:t.lineEnd,o=r;o<=i;o++)e.setCursor(o,0),K(e,t.argString.trimStart()),e.state.vim.insertMode&&eZ(e,!0);else K(e,t.argString.trimStart()),e.state.vim.insertMode&&eZ(e,!0)},global:function(e,t){var n=t.argString;if(!n){eD(e,"Regular Expression missing from global");return}var r="v"===t.commandName[0];"!"===n[0]&&"g"===t.commandName[0]&&(r=!0,n=n.slice(1));var i=void 0!==t.line?t.line:e.firstLine(),o=t.lineEnd||t.line||e.lastLine(),a=eB(n,"/"),s=n,l="";if(a&&a.length&&(s=a[0],l=a.slice(1,a.length).join("/")),s)try{eH(e,s,!0,!0)}catch(t){eD(e,"Invalid regex: "+s);return}for(var c=eR(e).getQuery(),u=[],h=i;h<=o;h++){var d=e.getLine(h);c.test(d)!==r&&u.push(l?e.getLineHandle(h):d)}if(!l){eD(e,u.join("\n"));return}var m=0,p=function(){if(m<u.length){var t=u[m++],n=e.getLineNumber(t);if(null==n){p();return}var r=n+1+l;ez.processCommand(e,r,{callback:p})}else e.releaseLineHandles&&e.releaseLineHandles()};p()},substitute:function(t,r){if(!t.getSearchCursor)throw Error("Search feature not available. Requires searchcursor.js or any other getSearchCursor implementation.");var i,a,s,l=r.argString,c=l?eB(l,l[0]):[],u="",h="",m=!1,p=!1;if(c&&c.length)u=c[0],b("pcre")&&""!==u&&(u=new RegExp(u).source),void 0!==(h=c[1])&&(h=b("pcre")?function(t){for(var n=new e.StringStream(t),r=[];!n.eol();){for(;n.peek()&&"\\"!=n.peek();)r.push(n.next());var i=!1;for(var o in eK)if(n.match(o,!0)){i=!0,r.push(eK[o]);break}i||r.push(n.next())}return r.join("")}(h.replace(/([^\\])&/g,"$1$$&")):function(e){for(var t=!1,n=[],r=-1;r<e.length;r++){var i=e.charAt(r)||"",o=e.charAt(r+1)||"";eI[i+o]?(n.push(eI[i+o]),r++):t?(n.push(i),t=!1):"\\"===i?(t=!0,d.test(o)||"$"===o)?n.push("$"):"/"!==o&&"\\"!==o&&n.push("\\"):("$"===i&&n.push("$"),n.push(i),"/"===o&&n.push("\\"))}return n.join("")}(h),n.lastSubstituteReplacePart=h),i=c[2]?c[2].split(" "):[];else if(l&&l.length){eD(t,"Substitutions should be of the form :s/pattern/replace/");return}if(i&&(a=i[0],s=parseInt(i[1]),a&&(-1!=a.indexOf("c")&&(m=!0),-1!=a.indexOf("g")&&(p=!0),u=b("pcre")?u+"/"+a:u.replace(/\//g,"\\/")+"/"+a)),u)try{eH(t,u,!0,!0)}catch(e){eD(t,"Invalid regex: "+u);return}if(void 0===(h=h||n.lastSubstituteReplacePart)){eD(t,"No previous substitute regular expression");return}var f=eR(t).getQuery(),g=void 0!==r.line?r.line:t.getCursor().line,v=r.lineEnd||g;g==t.firstLine()&&v==t.lastLine()&&(v=1/0),s&&(v=(g=v)+s-1);var y=Y(t,new o(g,0)),C=t.getSearchCursor(f,y);!function(t,n,r,i,o,a,s,l,c){t.state.vim.exMode=!0;var u,h,d,m=!1;function p(){t.operation(function(){for(;!m;)f(),g();v()})}function f(){var e=t.getRange(a.from(),a.to()).replace(s,l),n=a.to().line;a.replace(e),h=a.to().line,o+=h-n,d=h<n}function g(){for(var e,n,s,l;e=u&&er(a.to()),(n=a.findNext())&&!n[0]&&e&&ei(a.from(),e)&&(n=a.findNext()),n&&(s=a.from(),l=o,("number"!=typeof s&&(s=s.line),i instanceof Array)?x(s,i):"number"==typeof l?s>=i&&s<=l:s==i);)if(r||a.from().line!=h||d){t.scrollIntoView(a.from(),30),t.setSelection(a.from(),a.to()),u=a.from(),m=!1;return}m=!0}function v(e){if(e&&e(),t.focus(),u){t.setCursor(u);var n=t.state.vim;n.exMode=!1,n.lastHPos=n.lastHSPos=u.ch}c&&c()}if(g(),m){eD(t,"No matches for "+s.source);return}if(!n){p(),c&&c();return}eF(t,{prefix:eP("span","replace with ",eP("strong",l)," (y/n/a/q/l)"),onKeyDown:function(n,r,i){switch(e.e_stop(n),H(n)){case"y":f(),g();break;case"n":g();break;case"a":var o=c;c=void 0,t.operation(p),c=o;break;case"l":f();case"q":case"<Esc>":case"<C-c>":case"<C-[>":v(i)}return m&&v(i),!0}})}(t,m,p,g,v,C,f,h,r.callback)},startinsert:function(e,t){K(e,"!"==t.argString?"A":"i",{})},redo:e.commands.redo,undo:e.commands.undo,write:function(t){e.commands.save?e.commands.save(t):t.save&&t.save()},nohlsearch:function(e){eW(e)},yank:function(e){var t=er(e.getCursor()).line,r=e.getLine(t);n.registerController.pushText("0","yank",r,!0,!0)},delete:function(e,t){var n=t.selectionLine,r=isNaN(t.selectionLineEnd)?n:t.selectionLineEnd;X.delete(e,{linewise:!0},[{anchor:new o(n,0),head:new o(r+1,0)}])},join:function(e,t){var n=t.selectionLine,r=isNaN(t.selectionLineEnd)?n:t.selectionLineEnd;e.setCursor(new o(n,0)),G.joinLines(e,{repeat:r-n},e.state.vim)},delmarks:function(t,n){if(!n.argString||!eu(n.argString)){eD(t,"Argument required");return}for(var r=t.state.vim,i=new e.StringStream(eu(n.argString));!i.eol();){i.eatSpace();var o=i.pos;if(!i.match(/[a-zA-Z]/,!1)){eD(t,"Invalid argument: "+n.argString.substring(o));return}var a=i.next();if(i.match("-",!0)){if(!i.match(/[a-zA-Z]/,!1)){eD(t,"Invalid argument: "+n.argString.substring(o));return}var s=i.next();if(a&&s&&C(a)==C(s)){var l=a.charCodeAt(0),c=s.charCodeAt(0);if(l>=c){eD(t,"Invalid argument: "+n.argString.substring(o));return}for(var u=0;u<=c-l;u++){var h=String.fromCharCode(l+u);delete r.marks[h]}}else{eD(t,"Invalid argument: "+a+"-");return}}else a&&delete r.marks[a]}}},ez=new eQ;function eZ(t,r){var i=t.state.vim,o=n.macroModeState,a=n.registerController.getRegister("."),s=o.isPlaying,l=o.lastInsertModeChanges;s||(t.off("change",eG),i.insertEnd&&i.insertEnd.clear(),i.insertEnd=void 0,e.off(t.getInputField(),"keydown",e6)),!s&&i.insertModeRepeat>1&&(e2(t,i,i.insertModeRepeat-1,!0),i.lastEditInputState.repeatOverride=i.insertModeRepeat),delete i.insertModeRepeat,i.insertMode=!1,r||t.setCursor(t.getCursor().line,t.getCursor().ch-1),t.setOption("keyMap","vim"),t.setOption("disableInput",!0),t.toggleOverwrite(!1),a.setText(l.changes.join("")),e.signal(t,"vim-mode-change",{mode:"normal"}),o.isRecording&&function(e){if(!e.isPlaying){var t=e.latestRegister,r=n.registerController.getRegister(t);r&&r.pushInsertModeChanges&&r.pushInsertModeChanges(e.lastInsertModeChanges)}}(o)}function eX(e){s.unshift(e)}function eG(e,t){var r=n.macroModeState,i=r.lastInsertModeChanges;if(!r.isPlaying)for(var o=e.state.vim;t;){if(i.expectCursorActivityForChange=!0,i.ignoreCount>1)i.ignoreCount--;else if("+input"==t.origin||"paste"==t.origin||void 0===t.origin){var a=e.listSelections().length;a>1&&(i.ignoreCount=a);var s=t.text.join("\n");if(i.maybeReset&&(i.changes=[],i.maybeReset=!1),s){if(e.state.overwrite&&!/\n/.test(s))i.changes.push([s]);else{if(s.length>1){var l=o&&o.insertEnd&&o.insertEnd.find(),c=e.getCursor();if(l&&l.line==c.line){var u=l.ch-c.ch;u>0&&u<s.length&&(i.changes.push([s,u]),s="")}}s&&i.changes.push(s)}}}t=t.next}}function eY(e){var t=e.state.vim;if(t.insertMode){var r=n.macroModeState;if(r.isPlaying)return;var i=r.lastInsertModeChanges;i.expectCursorActivityForChange?i.expectCursorActivityForChange=!1:(i.maybeReset=!0,t.insertEnd&&t.insertEnd.clear(),t.insertEnd=e.setBookmark(e.getCursor(),{insertLeft:!0}))}else e.curOp?.isVimOp||e0(e,t)}function e0(t,n){var r=t.getCursor("anchor"),i=t.getCursor("head");if(n.visualMode&&!t.somethingSelected()?eg(t,!1):!n.visualMode&&!n.insertMode&&t.somethingSelected()&&(n.visualMode=!0,n.visualLine=!1,e.signal(t,"vim-mode-change",{mode:"visual"})),n.visualMode){var o=eo(i,r)?0:-1,a=eo(i,r)?-1:0;i=et(i,0,o),r=et(r,0,a),n.sel={anchor:r,head:i},eb(t,n,"<",ea(i,r)),eb(t,n,">",es(i,r))}else n.insertMode||(n.lastHPos=t.getCursor().ch)}function e1(e,t){this.keyName=e,this.key=t.key,this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.metaKey=t.metaKey,this.shiftKey=t.shiftKey}function e6(t){var r=n.macroModeState.lastInsertModeChanges,i=e.keyName?e.keyName(t):t.key;i&&(-1!=i.indexOf("Delete")||-1!=i.indexOf("Backspace"))&&(r.maybeReset&&(r.changes=[],r.maybeReset=!1),r.changes.push(new e1(i,t)))}function e2(e,t,r,i){var o=n.macroModeState;o.isPlaying=!0;var a=t.lastEditActionCommand,s=t.inputState;function l(){a?J.processAction(e,t,a):J.evalInput(e,t)}function c(n){o.lastInsertModeChanges.changes.length>0&&(n=t.lastEditActionCommand?n:1,e3(e,o.lastInsertModeChanges.changes,n))}if(t.inputState=t.lastEditInputState,a&&a.interlaceInsertRepeat)for(var u=0;u<r;u++)l(),c(1);else i||l(),c(r);t.inputState=s,t.insertMode&&!i&&eZ(e),o.isPlaying=!1}function e5(t,n){e.lookupKey(n,"vim-insert",function(n){return"string"==typeof n?e.commands[n](t):n(t),!0})}function e3(e,t,r){var i=e.getCursor("head"),o=n.macroModeState.lastInsertModeChanges.visualBlock;o&&(ed(e,i,o+1),r=e.listSelections().length,e.setCursor(i));for(var a=0;a<r;a++){o&&e.setCursor(et(i,a,0));for(var s=0;s<t.length;s++){var l=t[s];if(l instanceof e1)e5(e,l.keyName);else if("string"==typeof l)e.replaceSelection(l);else{var c=e.getCursor(),u=et(c,0,l[0].length-(l[1]||0));e.replaceRange(l[0],c,l[1]?c:u),e.setCursor(u)}}}o&&e.setCursor(et(i,0,1))}function e8(e){var t=new e.constructor;return Object.keys(e).forEach(function(n){if("insertEnd"!=n){var r=e[n];Array.isArray(r)?r=r.slice():r&&"object"==typeof r&&r.constructor!=Object&&(r=e8(r)),t[n]=r}}),e.sel&&(t.sel={head:e.sel.head&&er(e.sel.head),anchor:e.sel.anchor&&er(e.sel.anchor)}),t}return M("insertModeEscKeysTimeout",200,"number"),R(),B}(y),B=a.Lz.baseTheme({".cm-vimMode .cm-cursorLayer:not(.cm-vimCursorLayer)":{display:"none"},".cm-vim-panel":{padding:"0px 10px",fontFamily:"monospace",minHeight:"1.3em"},".cm-vim-panel input":{border:"none",outline:"none",backgroundColor:"inherit"},"&light .cm-searchMatch":{backgroundColor:"#ffff0054"},"&dark .cm-searchMatch":{backgroundColor:"#00ffff8a"}}),N=a.Z9.fromClass(class{constructor(e){this.status="",this.query=null,this.decorations=a.NZ.none,this.waitForCopy=!1,this.lastKeydown="",this.useNextTextInput=!1,this.compositionText="",this.view=e;let t=this.cm=new y(e);R.enterVimMode(this.cm),this.view.cm=this.cm,this.cm.state.vimPlugin=this,this.blockCursor=new O(e,t),this.updateClass(),this.cm.on("vim-command-done",()=>{t.state.vim&&(t.state.vim.status=""),this.blockCursor.scheduleRedraw(),this.updateStatus()}),this.cm.on("vim-mode-change",e=>{t.state.vim&&(t.state.vim.mode=e.mode,e.subMode&&(t.state.vim.mode+=" block"),t.state.vim.status="",this.blockCursor.scheduleRedraw(),this.updateClass(),this.updateStatus())}),this.cm.on("dialog",()=>{this.cm.state.statusbar?this.updateStatus():e.dispatch({effects:K.of(!!this.cm.state.dialog)})}),this.dom=document.createElement("span"),this.dom.style.cssText="position: absolute; right: 10px; top: 1px",this.statusButton=document.createElement("span"),this.statusButton.onclick=e=>{R.handleKey(this.cm,"<Esc>","user"),this.cm.focus()},this.statusButton.style.cssText="cursor: pointer"}update(e){var t;if((e.viewportChanged||e.docChanged)&&this.query&&this.highlight(this.query),e.docChanged&&this.cm.onChange(e),e.selectionSet&&this.cm.onSelectionChange(),e.viewportChanged,this.cm.curOp&&!this.cm.curOp.isVimOp&&this.cm.onBeforeEndOperation(),e.transactions){for(let n of e.transactions)for(let e of n.effects)if(e.is(s.Ri)){if(null===(t=e.value)||void 0===t?void 0:t.forVim){let t=e.value.create();this.highlight(t)}else this.highlight(null)}}this.blockCursor.update(e)}updateClass(){let e=this.cm.state;e.vim&&(!e.vim.insertMode||e.overwrite)?this.view.scrollDOM.classList.add("cm-vimMode"):this.view.scrollDOM.classList.remove("cm-vimMode")}updateStatus(){let e=this.cm.state.statusbar,t=this.cm.state.vim;if(!e||!t)return;let n=this.cm.state.dialog;if(n)n.parentElement!=e&&(e.textContent="",e.appendChild(n));else{e.textContent="";var r=(t.mode||"normal").toUpperCase();t.insertModeReturn&&(r+="(C-O)"),this.statusButton.textContent=`--${r}--`,e.appendChild(this.statusButton)}this.dom.textContent=t.status,e.appendChild(this.dom)}destroy(){R.leaveVimMode(this.cm),this.updateClass(),this.blockCursor.destroy(),delete this.view.cm}highlight(e){if(this.query=e,!e)return this.decorations=a.NZ.none;let{view:t}=this,n=new i.vB;for(let r=0,i=t.visibleRanges,o=i.length;r<o;r++){let{from:a,to:s}=i[r];for(;r<o-1&&s>i[r+1].from-500;)s=i[++r].to;e.highlight(t.state,a,s,(e,t)=>{n.add(e,t,I)})}return this.decorations=n.finish()}handleKey(e,t){let n=this.cm,r=n.state.vim;if(!r)return;let i=R.vimKeyFromEvent(e,r);if(y.signal(this.cm,"inputEvent",{type:"handleKey",key:i}),!i)return;if("<Esc>"==i&&!r.insertMode&&!r.visualMode&&this.query){let e=r.searchState_;e&&(n.removeOverlay(e.getOverlay()),e.setOverlay(null))}if("<C-c>"===i&&!y.isMac&&n.somethingSelected())return this.waitForCopy=!0,!0;r.status=(r.status||"")+i;let o=R.multiSelectHandleKey(n,i,"user");return r=R.maybeInitVimState_(n),!o&&r.insertMode&&n.state.overwrite&&(e.key&&1==e.key.length&&!/\n/.test(e.key)?(o=!0,n.overWriteSelection(e.key)):"Backspace"==e.key&&(o=!0,y.commands.cursorCharLeft(n))),o&&(y.signal(this.cm,"vim-keypress",i),e.preventDefault(),e.stopPropagation(),this.blockCursor.scheduleRedraw()),this.updateStatus(),!!o}},{eventHandlers:{copy:function(e,t){this.waitForCopy&&(this.waitForCopy=!1,Promise.resolve().then(()=>{var e=this.cm,t=e.state.vim;t&&(t.insertMode?e.setSelection(e.getCursor(),e.getCursor()):e.operation(()=>{e.curOp&&(e.curOp.isVimOp=!0),R.handleKey(e,"<Esc>","user")}))}))},compositionstart:function(e,t){this.useNextTextInput=!0,y.signal(this.cm,"inputEvent",e)},compositionupdate:function(e,t){y.signal(this.cm,"inputEvent",e)},compositionend:function(e,t){y.signal(this.cm,"inputEvent",e)},keypress:function(e,t){y.signal(this.cm,"inputEvent",e),"Dead"==this.lastKeydown&&this.handleKey(e,t)},keydown:function(e,t){y.signal(this.cm,"inputEvent",e),this.lastKeydown=e.key,"Unidentified"==this.lastKeydown||"Process"==this.lastKeydown||"Dead"==this.lastKeydown?this.useNextTextInput=!0:(this.useNextTextInput=!1,this.handleKey(e,t))}},provide:()=>[a.Lz.inputHandler.of((e,t,n,r)=>{var i,o,a=e.cm||null;if(!a)return!1;var s=null===(i=a.state)||void 0===i?void 0:i.vim,l=a.state.vimPlugin;if(s&&!s.insertMode&&!(null===(o=a.curOp)||void 0===o?void 0:o.isVimOp)){if("\0\0"===r)return!0;if(y.signal(a,"inputEvent",{type:"text",text:r,from:t,to:n}),1==r.length&&l.useNextTextInput){if(s.expectLiteralNext&&e.composing)return l.compositionText=r,!1;if(l.compositionText){var c=l.compositionText;l.compositionText="";var u=e.state.selection.main.head,h=e.state.sliceDoc(u-c.length,u);if(c===h){var d=a.getCursor();a.replaceRange("",a.posFromIndex(u-c.length),d)}}return l.handleKey({key:r,preventDefault:()=>{},stopPropagation:()=>{}}),function(e){var t=e.scrollDOM.parentElement;if(t){if(T){e.contentDOM.textContent="\0\0",e.contentDOM.dispatchEvent(new CustomEvent("compositionend"));return}var n=e.scrollDOM.nextSibling,r=window.getSelection(),i=r&&{anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset};e.scrollDOM.remove(),t.insertBefore(e.scrollDOM,n);try{i&&r&&(r.setPosition(i.anchorNode,i.anchorOffset),i.focusNode&&r.extend(i.focusNode,i.focusOffset))}catch(e){console.error(e)}e.focus(),e.contentDOM.dispatchEvent(new CustomEvent("compositionend"))}}(e),!0}}return!1})],decorations:e=>e.decorations}),I=a.NZ.mark({class:"cm-searchMatch"}),K=i.Pe.define(),P=i.sU.define({create:()=>!1,update(e,t){for(let n of t.effects)n.is(K)&&(e=n.value);return e},provide:e=>a.S7.from(e,e=>e?D:null)});function D(e){let t=document.createElement("div");t.className="cm-vim-panel";let n=e.cm;return n.state.dialog&&t.appendChild(n.state.dialog),{top:!1,dom:t}}function F(e){let t=document.createElement("div");t.className="cm-vim-panel";let n=e.cm;return n.state.statusbar=t,n.state.vimPlugin.updateStatus(),{dom:t}}function H(e={}){return[B,N,E,e.status?a.S7.of(F):P]}}}]);